# Практическая работа 1. Формы и валидация в Angular

### **Тема:** Reactive Forms, Template-driven Forms и кастомная валидация

### **Цель:** 
Научиться создавать сложные формы в Angular с использованием Reactive и Template-driven подходов. Освоить встроенную и кастомную валидацию, работу с FormArray, динамическими полями и создание пользовательского UX для отображения ошибок.

### **Теоретическая часть:**

**Типы форм в Angular:**

1. **Template-driven Forms**
```html
<form #form="ngForm" (ngSubmit)="onSubmit(form)">
  <input name="email" ngModel required email>
  <button type="submit">Отправить</button>
</form>
```

2. **Reactive Forms**
```typescript
form = new FormGroup({
  email: new FormControl('', [Validators.required, Validators.email])
});

onSubmit() {
  if (this.form.valid) {
    console.log(this.form.value);
  }
}
```

**Валидаторы:**
- Встроенные: `required`, `email`, `minLength`, `maxLength`, `pattern`
- Кастомные: функции валидации
- Валидаторы на уровне формы
- Асинхронные валидаторы

### **Ход работы:**

1. Создать Angular проект для демонстрации форм
2. Реализовать Reactive Forms для сложных сценариев
3. Создать Template-driven Forms для простых случаев
4. Реализовать кастомные валидаторы
5. Добавить динамические поля и FormArray
6. Создать пользовательский UX для отображения ошибок
7. Реализовать многошаговые формы
8. Протестировать все сценарии валидации
9. Оформить README.md с описанием работы

### **Практический пример:**

**1. Реактивная форма регистрации пользователя:**
```typescript
// registration.form.ts
import { Injectable } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl, ValidationErrors, ValidatorFn } from '@angular/forms';

export interface RegistrationData {
  personalInfo: {
    firstName: string;
    lastName: string;
    birthDate: Date;
    gender: 'male' | 'female' | 'other';
  };
  accountInfo: {
    email: string;
    username: string;
    passwords: {
      password: string;
      confirmPassword: string;
    };
  };
  preferences: {
    newsletter: boolean;
    notifications: boolean;
    theme: 'light' | 'dark' | 'auto';
  };
  address: {
    country: string;
    city: string;
    street: string;
    zipCode: string;
  };
}

@Injectable({
  providedIn: 'root'
})
export class RegistrationFormService {
  constructor(private fb: FormBuilder) {}

  createRegistrationForm(): FormGroup {
    return this.fb.group({
      personalInfo: this.fb.group({
        firstName: ['', [
          Validators.required,
          Validators.minLength(2),
          Validators.maxLength(50),
          this.noSpecialCharactersValidator()
        ]],
        lastName: ['', [
          Validators.required,
          Validators.minLength(2),
          Validators.maxLength(50),
          this.noSpecialCharactersValidator()
        ]],
        birthDate: ['', [
          Validators.required,
          this.ageValidator(18)
        ]],
        gender: ['', Validators.required]
      }),
      
      accountInfo: this.fb.group({
        email: ['', [
          Validators.required,
          Validators.email
        ]],
        username: ['', [
          Validators.required,
          Validators.minLength(3),
          Validators.maxLength(20),
          Validators.pattern(/^[a-zA-Z0-9_]+$/)
        ]],
        passwords: this.fb.group({
          password: ['', [
            Validators.required,
            Validators.minLength(8),
            this.passwordStrengthValidator()
          ]],
          confirmPassword: ['', Validators.required]
        }, { validators: this.passwordMatchValidator })
      }),
      
      preferences: this.fb.group({
        newsletter: [true],
        notifications: [true],
        theme: ['auto']
      }),
      
      address: this.fb.group({
        country: ['', Validators.required],
        city: ['', [
          Validators.required,
          Validators.minLength(2)
        ]],
        street: ['', [
          Validators.required,
          Validators.minLength(5)
        ]],
        zipCode: ['', [
          Validators.required,
          Validators.pattern(/^\d{5,6}$/)
        ]]
      })
    }, { validators: this.businessRulesValidator });
  }

  // Кастомные валидаторы
  private noSpecialCharactersValidator(): ValidatorFn {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) return null;
      
      const regex = /^[a-zA-Zа-яА-ЯёЁ\s]+$/;
      const valid = regex.test(control.value);
      
      return valid ? null : { noSpecialCharacters: true };
    };
  }

  private ageValidator(minAge: number): ValidatorFn {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) return null;
      
      const birthDate = new Date(control.value);
      const today = new Date();
      const age = today.getFullYear() - birthDate.getFullYear();
      
      // Проверка на корректную дату
      if (isNaN(birthDate.getTime())) {
        return { invalidDate: true };
      }
      
      // Проверка возраста
      if (age < minAge) {
        return { minAge: { requiredAge: minAge, actualAge: age } };
      }
      
      // Проверка что дата не в будущем
      if (birthDate > today) {
        return { futureDate: true };
      }
      
      return null;
    };
  }

  private passwordStrengthValidator(): ValidatorFn {
    return (control: AbstractControl): ValidationErrors | null => {
      if (!control.value) return null;
      
      const value = control.value;
      const errors: ValidationErrors = {};
      
      if (!/(?=.*[a-z])/.test(value)) {
        errors['missingLowerCase'] = true;
      }
      
      if (!/(?=.*[A-Z])/.test(value)) {
        errors['missingUpperCase'] = true;
      }
      
      if (!/(?=.*[0-9])/.test(value)) {
        errors['missingNumber'] = true;
      }
      
      if (!/(?=.*[!@#$%^&*])/.test(value)) {
        errors['missingSpecial'] = true;
      }
      
      return Object.keys(errors).length > 0 ? errors : null;
    };
  }

  private passwordMatchValidator(group: AbstractControl): ValidationErrors | null {
    const password = group.get('password')?.value;
    const confirmPassword = group.get('confirmPassword')?.value;
    
    return password === confirmPassword ? null : { passwordMismatch: true };
  }

  private businessRulesValidator(group: AbstractControl): ValidationErrors | null {
    const personalInfo = group.get('personalInfo');
    const accountInfo = group.get('accountInfo');
    
    const firstName = personalInfo?.get('firstName')?.value;
    const username = accountInfo?.get('username')?.value;
    const password = accountInfo?.get('passwords.password')?.value;
    
    const errors: ValidationErrors = {};
    
    // Имя пользователя не должно содержать имя
    if (firstName && username && username.toLowerCase().includes(firstName.toLowerCase())) {
      errors['usernameContainsName'] = true;
    }
    
    // Пароль не должен содержать имя пользователя
    if (username && password && password.toLowerCase().includes(username.toLowerCase())) {
      errors['passwordContainsUsername'] = true;
    }
    
    return Object.keys(errors).length > 0 ? errors : null;
  }

  // Вспомогательные методы
  markAllAsTouched(form: FormGroup): void {
    Object.keys(form.controls).forEach(key => {
      const control = form.get(key);
      if (control instanceof FormGroup) {
        this.markAllAsTouched(control);
      } else {
        control?.markAsTouched();
      }
    });
  }

  getFormErrors(form: FormGroup): any {
    const errors: any = {};
    
    Object.keys(form.controls).forEach(key => {
      const control = form.get(key);
      if (control instanceof FormGroup) {
        errors[key] = this.getFormErrors(control);
      } else {
        errors[key] = control?.errors;
      }
    });
    
    return errors;
  }
}
```

**2. Компонент многошаговой формы регистрации:**
```typescript
// registration.component.ts
import { Component, inject, signal, computed, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, AbstractControl } from '@angular/forms';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule } from '@angular/forms';
import { RegistrationFormService, RegistrationData } from './registration.form';

@Component({
  selector: 'app-registration',
  templateUrl: './registration.component.html',
  styleUrls: ['./registration.component.css'],
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule]
})
export class RegistrationComponent implements OnInit {
  private fb = inject(FormBuilder);
  private registrationFormService = inject(RegistrationFormService);

  // Состояние формы
  currentStep = signal(1);
  totalSteps = 4;
  isSubmitting = signal(false);
  submissionError = signal<string | null>(null);

  // Форма
  registrationForm!: FormGroup;

  // Вычисляемые свойства
  progress = computed(() => (this.currentStep() / this.totalSteps) * 100);
  isFirstStep = computed(() => this.currentStep() === 1);
  isLastStep = computed(() => this.currentStep() === this.totalSteps);
  canProceed = computed(() => this.isCurrentStepValid());

  // Данные для селектов
  countries = [
    { value: 'ru', label: 'Россия' },
    { value: 'kz', label: 'Казахстан' },
    { value: 'by', label: 'Беларусь' },
    { value: 'ua', label: 'Украина' }
  ];

  genders = [
    { value: 'male', label: 'Мужской' },
    { value: 'female', label: 'Женский' },
    { value: 'other', label: 'Другой' }
  ];

  themes = [
    { value: 'light', label: 'Светлая' },
    { value: 'dark', label: 'Темная' },
    { value: 'auto', label: 'Авто' }
  ];

  ngOnInit() {
    this.initializeForm();
  }

  private initializeForm() {
    this.registrationForm = this.registrationFormService.createRegistrationForm();
    
    // Логирование изменений для отладки
    this.registrationForm.valueChanges.subscribe(value => {
      console.log('Form changes:', value);
    });
  }

  // Навигация по шагам
  nextStep() {
    if (this.isCurrentStepValid()) {
      this.currentStep.update(step => Math.min(step + 1, this.totalSteps));
      this.submissionError.set(null);
    } else {
      this.markCurrentStepAsTouched();
    }
  }

  prevStep() {
    this.currentStep.update(step => Math.max(step - 1, 1));
    this.submissionError.set(null);
  }

  goToStep(step: number) {
    if (step >= 1 && step <= this.totalSteps) {
      this.currentStep.set(step);
    }
  }

  private isCurrentStepValid(): boolean {
    switch (this.currentStep()) {
      case 1:
        return this.registrationForm.get('personalInfo')?.valid || false;
      case 2:
        return this.registrationForm.get('accountInfo')?.valid || false;
      case 3:
        return this.registrationForm.get('address')?.valid || false;
      case 4:
        return this.registrationForm.get('preferences')?.valid || false;
      default:
        return false;
    }
  }

  private markCurrentStepAsTouched() {
    switch (this.currentStep()) {
      case 1:
        this.registrationForm.get('personalInfo')?.markAllAsTouched();
        break;
      case 2:
        this.registrationForm.get('accountInfo')?.markAllAsTouched();
        break;
      case 3:
        this.registrationForm.get('address')?.markAllAsTouched();
        break;
      case 4:
        this.registrationForm.get('preferences')?.markAllAsTouched();
        break;
    }
  }

  // Отправка формы
  async onSubmit() {
    if (this.registrationForm.valid) {
      this.isSubmitting.set(true);
      this.submissionError.set(null);

      try {
        const formData: RegistrationData = this.registrationForm.value;
        console.log('Submitting form:', formData);
        
        // Имитация API запроса
        await this.simulateApiCall(formData);
        
        this.showSuccessMessage();
        this.resetForm();
        
      } catch (error) {
        this.submissionError.set('Произошла ошибка при отправке формы. Попробуйте еще раз.');
        console.error('Submission error:', error);
      } finally {
        this.isSubmitting.set(false);
      }
    } else {
      this.registrationFormService.markAllAsTouched(this.registrationForm);
      this.submissionError.set('Пожалуйста, исправьте ошибки в форме.');
    }
  }

  private simulateApiCall(data: RegistrationData): Promise<void> {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        // 10% шанс ошибки для демонстрации
        if (Math.random() < 0.1) {
          reject(new Error('Server error'));
        } else {
          resolve();
        }
      }, 2000);
    });
  }

  private showSuccessMessage() {
    alert('Регистрация успешно завершена! Добро пожаловать!');
  }

  private resetForm() {
    this.registrationForm.reset({
      preferences: {
        newsletter: true,
        notifications: true,
        theme: 'auto'
      }
    });
    this.currentStep.set(1);
  }

  // Вспомогательные методы для шаблона
  get personalInfo() { return this.registrationForm.get('personalInfo'); }
  get accountInfo() { return this.registrationForm.get('accountInfo'); }
  get address() { return this.registrationForm.get('address'); }
  get preferences() { return this.registrationForm.get('preferences'); }

  getControl(controlPath: string): AbstractControl | null {
    return this.registrationForm.get(controlPath);
  }

  hasError(controlPath: string, errorCode: string): boolean {
    const control = this.getControl(controlPath);
    return control ? control.hasError(errorCode) && control.touched : false;
  }

  getError(controlPath: string, errorCode: string): any {
    const control = this.getControl(controlPath);
    return control ? control.getError(errorCode) : null;
  }

  // Пароль strength indicator
  getPasswordStrength(): number {
    const password = this.accountInfo?.get('passwords.password')?.value;
    if (!password) return 0;

    let strength = 0;
    if (password.length >= 8) strength += 25;
    if (/[a-z]/.test(password)) strength += 25;
    if (/[A-Z]/.test(password)) strength += 25;
    if (/[0-9!@#$%^&*]/.test(password)) strength += 25;

    return strength;
  }

  getPasswordStrengthText(): string {
    const strength = this.getPasswordStrength();
    if (strength === 0) return 'Введите пароль';
    if (strength <= 25) return 'Слабый';
    if (strength <= 50) return 'Средний';
    if (strength <= 75) return 'Хороший';
    return 'Отличный';
  }

  getPasswordStrengthClass(): string {
    const strength = this.getPasswordStrength();
    if (strength <= 25) return 'strength-weak';
    if (strength <= 50) return 'strength-medium';
    if (strength <= 75) return 'strength-good';
    return 'strength-strong';
  }
}
```

```html
<!-- registration.component.html -->
<div class="registration-container">
  <div class="registration-card">
    <!-- Заголовок и прогресс-бар -->
    <header class="registration-header">
      <h1>📝 Регистрация аккаунта</h1>
      <p>Заполните информацию для создания нового аккаунта</p>
      
      <!-- Прогресс-бар -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progress()"></div>
        </div>
        <div class="progress-steps">
          @for (step of [1,2,3,4]; track step) {
            <button 
              class="step-indicator"
              [class.active]="currentStep() === step"
              [class.completed]="currentStep() > step"
              (click)="goToStep(step)"
            >
              {{ step }}
            </button>
          }
        </div>
        <div class="step-labels">
          <span>Личные данные</span>
          <span>Аккаунт</span>
          <span>Адрес</span>
          <span>Настройки</span>
        </div>
      </div>
    </header>

    <!-- Сообщение об ошибке -->
    @if (submissionError()) {
      <div class="error-message global-error">
        ❌ {{ submissionError() }}
      </div>
    }

    <!-- Форма -->
    <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()" class="registration-form">
      
      <!-- Шаг 1: Личные данные -->
      @if (currentStep() === 1) {
        <div class="form-step">
          <h2>👤 Личные данные</h2>
          
          <div class="form-grid">
            <!-- Имя -->
            <div class="form-group">
              <label for="firstName">Имя *</label>
              <input 
                type="text" 
                id="firstName"
                formControlName="firstName"
                [class.error]="hasError('personalInfo.firstName', 'required') || hasError('personalInfo.firstName', 'noSpecialCharacters')"
                placeholder="Введите ваше имя"
              >
              @if (hasError('personalInfo.firstName', 'required')) {
                <span class="error-message">Имя обязательно для заполнения</span>
              }
              @if (hasError('personalInfo.firstName', 'minlength')) {
                <span class="error-message">Минимальная длина: 2 символа</span>
              }
              @if (hasError('personalInfo.firstName', 'noSpecialCharacters')) {
                <span class="error-message">Имя не должно содержать специальные символы</span>
              }
            </div>

            <!-- Фамилия -->
            <div class="form-group">
              <label for="lastName">Фамилия *</label>
              <input 
                type="text" 
                id="lastName"
                formControlName="lastName"
                [class.error]="hasError('personalInfo.lastName', 'required')"
                placeholder="Введите вашу фамилию"
              >
              @if (hasError('personalInfo.lastName', 'required')) {
                <span class="error-message">Фамилия обязательна для заполнения</span>
              }
            </div>

            <!-- Дата рождения -->
            <div class="form-group">
              <label for="birthDate">Дата рождения *</label>
              <input 
                type="date" 
                id="birthDate"
                formControlName="birthDate"
                [class.error]="hasError('personalInfo.birthDate', 'required') || hasError('personalInfo.birthDate', 'minAge')"
                [max]="maxBirthDate()"
              >
              @if (hasError('personalInfo.birthDate', 'required')) {
                <span class="error-message">Дата рождения обязательна</span>
              }
              @if (hasError('personalInfo.birthDate', 'minAge')) {
                <span class="error-message">
                  Минимальный возраст: {{ getError('personalInfo.birthDate', 'minAge')?.requiredAge }} лет
                </span>
              }
              @if (hasError('personalInfo.birthDate', 'futureDate')) {
                <span class="error-message">Дата рождения не может быть в будущем</span>
              }
            </div>

            <!-- Пол -->
            <div class="form-group">
              <label for="gender">Пол *</label>
              <select 
                id="gender"
                formControlName="gender"
                [class.error]="hasError('personalInfo.gender', 'required')"
              >
                <option value="">Выберите пол</option>
                @for (gender of genders; track gender.value) {
                  <option [value]="gender.value">{{ gender.label }}</option>
                }
              </select>
              @if (hasError('personalInfo.gender', 'required')) {
                <span class="error-message">Выберите пол</span>
              }
            </div>
          </div>
        </div>
      }

      <!-- Шаг 2: Аккаунт -->
      @if (currentStep() === 2) {
        <div class="form-step">
          <h2>🔐 Данные аккаунта</h2>
          
          <div class="form-grid">
            <!-- Email -->
            <div class="form-group">
              <label for="email">Email *</label>
              <input 
                type="email" 
                id="email"
                formControlName="email"
                [class.error]="hasError('accountInfo.email', 'required') || hasError('accountInfo.email', 'email')"
                placeholder="your@email.com"
              >
              @if (hasError('accountInfo.email', 'required')) {
                <span class="error-message">Email обязателен</span>
              }
              @if (hasError('accountInfo.email', 'email')) {
                <span class="error-message">Введите корректный email</span>
              }
            </div>

            <!-- Имя пользователя -->
            <div class="form-group">
              <label for="username">Имя пользователя *</label>
              <input 
                type="text" 
                id="username"
                formControlName="username"
                [class.error]="hasError('accountInfo.username', 'required') || hasError('accountInfo.username', 'pattern')"
                placeholder="username"
              >
              @if (hasError('accountInfo.username', 'required')) {
                <span class="error-message">Имя пользователя обязательно</span>
              }
              @if (hasError('accountInfo.username', 'minlength')) {
                <span class="error-message">Минимальная длина: 3 символа</span>
              }
              @if (hasError('accountInfo.username', 'pattern')) {
                <span class="error-message">Только буквы, цифры и подчеркивания</span>
              }
            </div>

            <!-- Пароль -->
            <div class="form-group" formGroupName="passwords">
              <label for="password">Пароль *</label>
              <input 
                type="password" 
                id="password"
                formControlName="password"
                [class.error]="hasError('accountInfo.passwords.password', 'required')"
                placeholder="Введите пароль"
              >
              
              <!-- Индикатор сложности пароля -->
              @if (accountInfo?.get('passwords.password')?.value) {
                <div class="password-strength">
                  <div class="strength-bar">
                    <div 
                      class="strength-fill" 
                      [class]="getPasswordStrengthClass()"
                      [style.width.%]="getPasswordStrength()"
                    ></div>
                  </div>
                  <span class="strength-text">{{ getPasswordStrengthText() }}</span>
                </div>
              }

              <!-- Ошибки пароля -->
              <div class="password-requirements">
                @if (hasError('accountInfo.passwords.password', 'required')) {
                  <span class="error-message">Пароль обязателен</span>
                }
                @if (hasError('accountInfo.passwords.password', 'minlength')) {
                  <span class="error-message">Минимальная длина: 8 символов</span>
                }
                @if (hasError('accountInfo.passwords.password', 'missingLowerCase')) {
                  <span class="error-message">Добавьте строчные буквы</span>
                }
                @if (hasError('accountInfo.passwords.password', 'missingUpperCase')) {
                  <span class="error-message">Добавьте заглавные буквы</span>
                }
                @if (hasError('accountInfo.passwords.password', 'missingNumber')) {
                  <span class="error-message">Добавьте цифры</span>
                }
                @if (hasError('accountInfo.passwords.password', 'missingSpecial')) {
                  <span class="error-message">Добавьте специальные символы</span>
                }
              </div>
            </div>

            <!-- Подтверждение пароля -->
            <div class="form-group" formGroupName="passwords">
              <label for="confirmPassword">Подтверждение пароля *</label>
              <input 
                type="password" 
                id="confirmPassword"
                formControlName="confirmPassword"
                [class.error]="hasError('accountInfo.passwords', 'passwordMismatch')"
                placeholder="Повторите пароль"
              >
              @if (hasError('accountInfo.passwords', 'passwordMismatch')) {
                <span class="error-message">Пароли не совпадают</span>
              }
            </div>
          </div>

          <!-- Ошибки уровня формы -->
          @if (registrationForm.hasError('usernameContainsName')) {
            <div class="form-level-error">
              ⚠️ Имя пользователя не должно содержать ваше имя
            </div>
          }
          @if (registrationForm.hasError('passwordContainsUsername')) {
            <div class="form-level-error">
              ⚠️ Пароль не должен содержать имя пользователя
            </div>
          }
        </div>
      }

      <!-- Шаг 3: Адрес -->
      @if (currentStep() === 3) {
        <div class="form-step">
          <h2>🏠 Адрес</h2>
          
          <div class="form-grid">
            <!-- Страна -->
            <div class="form-group">
              <label for="country">Страна *</label>
              <select 
                id="country"
                formControlName="country"
                [class.error]="hasError('address.country', 'required')"
              >
                <option value="">Выберите страну</option>
                @for (country of countries; track country.value) {
                  <option [value]="country.value">{{ country.label }}</option>
                }
              </select>
              @if (hasError('address.country', 'required')) {
                <span class="error-message">Выберите страну</span>
              }
            </div>

            <!-- Город -->
            <div class="form-group">
              <label for="city">Город *</label>
              <input 
                type="text" 
                id="city"
                formControlName="city"
                [class.error]="hasError('address.city', 'required')"
                placeholder="Введите город"
              >
              @if (hasError('address.city', 'required')) {
                <span class="error-message">Город обязателен</span>
              }
            </div>

            <!-- Улица -->
            <div class="form-group">
              <label for="street">Улица и дом *</label>
              <input 
                type="text" 
                id="street"
                formControlName="street"
                [class.error]="hasError('address.street', 'required')"
                placeholder="ул. Примерная, д. 123"
              >
              @if (hasError('address.street', 'required')) {
                <span class="error-message">Адрес обязателен</span>
              }
            </div>

            <!-- Почтовый индекс -->
            <div class="form-group">
              <label for="zipCode">Почтовый индекс *</label>
              <input 
                type="text" 
                id="zipCode"
                formControlName="zipCode"
                [class.error]="hasError('address.zipCode', 'required') || hasError('address.zipCode', 'pattern')"
                placeholder="123456"
              >
              @if (hasError('address.zipCode', 'required')) {
                <span class="error-message">Индекс обязателен</span>
              }
              @if (hasError('address.zipCode', 'pattern')) {
                <span class="error-message">Формат: 5 или 6 цифр</span>
              }
            </div>
          </div>
        </div>
      }

      <!-- Шаг 4: Настройки -->
      @if (currentStep() === 4) {
        <div class="form-step">
          <h2>⚙️ Настройки</h2>
          
          <div class="preferences-grid">
            <!-- Рассылка -->
            <div class="preference-item">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="newsletter">
                <span class="checkmark"></span>
                Подписаться на email рассылку
              </label>
              <p class="preference-description">Получайте новости и специальные предложения</p>
            </div>

            <!-- Уведомления -->
            <div class="preference-item">
              <label class="checkbox-label">
                <input type="checkbox" formControlName="notifications">
                <span class="checkmark"></span>
                Включить уведомления
              </label>
              <p class="preference-description">Получайте уведомления о важных событиях</p>
            </div>

            <!-- Тема -->
            <div class="preference-item">
              <label>Тема интерфейса</label>
              <div class="theme-options">
                @for (theme of themes; track theme.value) {
                  <label class="theme-option">
                    <input 
                      type="radio" 
                      [value]="theme.value" 
                      formControlName="theme"
                    >
                    <span class="theme-label">{{ theme.label }}</span>
                  </label>
                }
              </div>
            </div>
          </div>

          <!-- Сводка -->
          <div class="summary-section">
            <h3>📋 Сводка данных</h3>
            <div class="summary-content">
              <div class="summary-item">
                <strong>Имя:</strong> {{ personalInfo?.get('firstName')?.value }} {{ personalInfo?.get('lastName')?.value }}
              </div>
              <div class="summary-item">
                <strong>Email:</strong> {{ accountInfo?.get('email')?.value }}
              </div>
              <div class="summary-item">
                <strong>Страна:</strong> {{ address?.get('country')?.value | countryName }}
              </div>
              <div class="summary-item">
                <strong>Город:</strong> {{ address?.get('city')?.value }}
              </div>
            </div>
          </div>
        </div>
      }

      <!-- Навигация -->
      <footer class="form-footer">
        <div class="navigation-buttons">
          @if (!isFirstStep()) {
            <button type="button" (click)="prevStep()" class="btn-secondary">
              ← Назад
            </button>
          }
          
          @if (!isLastStep()) {
            <button 
              type="button" 
              (click)="nextStep()" 
              class="btn-primary"
              [disabled]="!canProceed()"
            >
              Далее →
            </button>
          } @else {
            <button 
              type="submit" 
              class="btn-success"
              [disabled]="isSubmitting()"
            >
              @if (isSubmitting()) {
                <span class="spinner"></span>
                Отправка...
              } @else {
                ✅ Завершить регистрацию
              }
            </button>
          }
        </div>
        
        <div class="form-stats">
          <span>Шаг {{ currentStep() }} из {{ totalSteps }}</span>
          <span>Заполнено: {{ progress() | number:'1.0-0' }}%</span>
        </div>
      </footer>
    </form>
  </div>
</div>
```

```css
/* registration.component.css */
.registration-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
}

.registration-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 20px 40px rgba(0,0,0,0.1);
  width: 100%;
  max-width: 800px;
  overflow: hidden;
}

.registration-header {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
  padding: 2rem;
  text-align: center;
}

.registration-header h1 {
  margin: 0 0 0.5rem 0;
  font-size: 2rem;
}

.registration-header p {
  margin: 0;
  opacity: 0.9;
}

/* Прогресс-бар */
.progress-container {
  margin-top: 2rem;
}

.progress-bar {
  background: rgba(255,255,255,0.3);
  height: 6px;
  border-radius: 3px;
  overflow: hidden;
  margin-bottom: 1rem;
}

.progress-fill {
  background: white;
  height: 100%;
  transition: width 0.3s ease;
}

.progress-steps {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.step-indicator {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.5);
  background: transparent;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.step-indicator.active {
  background: white;
  color: #4facfe;
  border-color: white;
}

.step-indicator.completed {
  background: rgba(255,255,255,0.8);
  color: #4facfe;
  border-color: white;
}

.step-labels {
  display: flex;
  justify-content: space-between;
  font-size: 0.8rem;
  opacity: 0.8;
}

/* Форма */
.registration-form {
  padding: 2rem;
}

.form-step {
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.form-step h2 {
  margin: 0 0 1.5rem 0;
  color: #2c3e50;
  border-bottom: 2px solid #ecf0f1;
  padding-bottom: 0.5rem;
}

/* Сетка формы */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}

@media (max-width: 768px) {
  .form-grid {
    grid-template-columns: 1fr;
  }
}

/* Группы формы */
.form-group {
  display: flex;
  flex-direction: column;
}

.form-group label {
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #2c3e50;
}

.form-group input,
.form-group select {
  padding: 0.75rem;
  border: 2px solid #e9ecef;
  border-radius: 6px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: #4facfe;
  box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
}

.form-group input.error,
.form-group select.error {
  border-color: #e74c3c;
  box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
}

/* Сообщения об ошибках */
.error-message {
  color: #e74c3c;
  font-size: 0.8rem;
  margin-top: 0.25rem;
}

.global-error {
  background: #f8d7da;
  color: #721c24;
  padding: 1rem;
  border-radius: 6px;
  margin: 1rem 2rem;
  border-left: 4px solid #e74c3c;
}

.form-level-error {
  background: #fff3cd;
  color: #856404;
  padding: 1rem;
  border-radius: 6px;
  margin-top: 1rem;
  border-left: 4px solid #ffc107;
}

/* Сложность пароля */
.password-strength {
  margin-top: 0.5rem;
}

.strength-bar {
  background: #e9ecef;
  height: 4px;
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: 0.25rem;
}

.strength-fill {
  height: 100%;
  transition: width 0.3s ease;
}

.strength-weak { background: #e74c3c; }
.strength-medium { background: #f39c12; }
.strength-good { background: #3498db; }
.strength-strong { background: #27ae60; }

.strength-text {
  font-size: 0.8rem;
  font-weight: 600;
}

.strength-weak + .strength-text { color: #e74c3c; }
.strength-medium + .strength-text { color: #f39c12; }
.strength-good + .strength-text { color: #3498db; }
.strength-strong + .strength-text { color: #27ae60; }

.password-requirements {
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  margin-top: 0.5rem;
}

/* Настройки */
.preferences-grid {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.preference-item {
  padding: 1rem;
  border: 1px solid #e9ecef;
  border-radius: 8px;
  background: #f8f9fa;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-weight: 600;
}

.checkmark {
  width: 20px;
  height: 20px;
  border: 2px solid #bdc3c7;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

input[type="checkbox"]:checked + .checkmark {
  background: #27ae60;
  border-color: #27ae60;
}

input[type="checkbox"]:checked + .checkmark::after {
  content: '✓';
  color: white;
  font-size: 14px;
}

.preference-description {
  margin: 0.5rem 0 0 0;
  color: #7f8c8d;
  font-size: 0.9rem;
}

.theme-options {
  display: flex;
  gap: 1rem;
  margin-top: 0.5rem;
}

.theme-option {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
}

.theme-label {
  padding: 0.5rem 1rem;
  border: 2px solid #e9ecef;
  border-radius: 6px;
  transition: all 0.3s ease;
}

input[type="radio"]:checked + .theme-label {
  background: #4facfe;
  color: white;
  border-color: #4facfe;
}

/* Сводка */
.summary-section {
  background: #f8f9fa;
  padding: 1.5rem;
  border-radius: 8px;
  margin-top: 2rem;
  border-left: 4px solid #4facfe;
}

.summary-section h3 {
  margin: 0 0 1rem 0;
  color: #2c3e50;
}

.summary-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.5rem;
}

.summary-item {
  padding: 0.25rem 0;
}

/* Футер формы */
.form-footer {
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid #e9ecef;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.navigation-buttons {
  display: flex;
  gap: 1rem;
}

.form-stats {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  font-size: 0.9rem;
  color: #7f8c8d;
}

/* Кнопки */
button {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 6px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.btn-primary {
  background: #4facfe;
  color: white;
}

.btn-primary:hover:not(:disabled) {
  background: #3a9dfd;
  transform: translateY(-1px);
}

.btn-secondary {
  background: #6c757d;
  color: white;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-success {
  background: #27ae60;
  color: white;
}

.btn-success:hover:not(:disabled) {
  background: #219653;
}

button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
}

/* Спиннер */
.spinner {
  width: 16px;
  height: 16px;
  border: 2px solid transparent;
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Адаптивность */
@media (max-width: 768px) {
  .registration-container {
    padding: 1rem;
  }
  
  .registration-card {
    margin: 0;
  }
  
  .registration-header {
    padding: 1.5rem;
  }
  
  .registration-form {
    padding: 1.5rem;
  }
  
  .form-footer {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
  
  .form-stats {
    align-items: center;
  }
  
  .step-labels {
    display: none;
  }
  
  .summary-content {
    grid-template-columns: 1fr;
  }
}
```

**3. Пайп для форматирования названия страны:**
```typescript
// country-name.pipe.ts
import { Pipe, PipeTransform } from '@angular/core';

@Pipe({
  name: 'countryName',
  standalone: true
})
export class CountryNamePipe implements PipeTransform {
  private countryMap: { [key: string]: string } = {
    'ru': 'Россия',
    'kz': 'Казахстан',
    'by': 'Беларусь',
    'ua': 'Украина',
    'us': 'США',
    'de': 'Германия',
    'fr': 'Франция'
  };

  transform(countryCode: string): string {
    return this.countryMap[countryCode] || countryCode;
  }
}
```

**4. Вспомогательная функция для максимальной даты рождения:**
```typescript
// registration.component.ts (дополнение)
export class RegistrationComponent {
  // ...

  maxBirthDate(): string {
    const today = new Date();
    const minAgeDate = new Date(
      today.getFullYear() - 18,
      today.getMonth(),
      today.getDate()
    );
    return minAgeDate.toISOString().split('T')[0];
  }
}
```

---

## **Варианты заданий:**

### **Вариант 1: Форма заказа товаров**
Создайте форму для:
- Выбора товаров с количеством
- Данных доставки
- Способа оплаты
- Промокодов и скидок

### **Вариант 2: Форма бронирования отеля**
Создайте форму для:
- Выбора дат заезда/выезда
- Типа номера и количества гостей
- Дополнительных услуг
- Контактных данных

### **Вариант 3: Форма создания резюме**
Создайте форму для:
- Личной информации
- Образования и опыта работы
- Навыков и компетенций
- Проектов и достижений

### **Вариант 4: Форма медицинской анкеты**
Создайте форму для:
- История болезней
- Аллергии и противопоказания
- Принимаемые лекарства
- Экстренные контакты

### **Вариант 5: Форма подачи заявки на кредит**
Создайте форму для:
- Персональных данных
- Финансовой информации
- Залогового имущества
- Кредитной истории

### **Вариант 6: Форма настройки профиля**
Создайте форму для:
- Аватара и основной информации
- Настроек конфиденциальности
- Уведомлений
- Связки с соцсетями

### **Вариант 7: Форма создания мероприятия**
Создайте форму для:
- Основной информации о событии
- Даты и времени
- Местоположения
- Билетов и регистрации

### **Вариант 8: Форма обратной связи**
Создайте форму для:
- Типа обращения
- Детального описания проблемы
- Прикрепления файлов
- Контактных данных

### **Вариант 9: Форма подписки на услуги**
Создайте форму для:
- Выбора тарифного плана
- Дополнительных опций
- Платежной информации
- Юридических соглашений

### **Вариант 10: Форма опроса**
Создайте форму для:
- Демографических вопросов
- Шкал оценки
- Множественного выбора
- Открытых вопросов

---

## **Критерии оценки:**

### **5 (Отлично):**
- Полная реализация всех видов форм и валидации
- Корректная работа Reactive и Template-driven форм
- Сложные кастомные валидаторы
- Оптимальный UX для отображения ошибок
- Полная обработка всех сценариев
- Качественные тесты

### **4 (Хорошо):**
- Основные формы реализованы
- Правильное применение валидаторов
- Хороший UX для пользователя
- Базовая обработка ошибок

### **3 (Удовлетворительно):**
- Базовые формы созданы
- Есть ошибки в валидации
- Минимальный UX
- Неполная обработка ошибок

### **2 (Неудовлетворительно):**
- Формы не работают
- Критические ошибки в валидации
- Отсутствие UX для ошибок
- Код не соответствует требованиям

---

## **Контрольные вопросы:**

1. В чем разница между Reactive и Template-driven формами?
2. Как создать кастомный валидатор?
3. Когда использовать FormArray?
4. Как валидировать несколько взаимосвязанных полей?
5. Как оптимизировать производительность форм?
6. Какие лучшие практики UX для отображения ошибок?
7. Как тестировать формы и валидаторы?
8. Когда использовать асинхронные валидаторы?
9. Как работать с динамическими полями?
10. Какие паттерны для сложных многошаговых форм?

---

## **Инструкция по выполнению:**

1. **Создание проекта:**
```bash
ng new forms-practice --standalone
cd forms-practice
```

2. **Создание сервиса формы:**
```bash
ng generate service services/registration-form
```

3. **Создание компонента:**
```bash
ng generate component components/registration
```

4. **Создание пайпов и валидаторов:**
```bash
ng generate pipe pipes/country-name
```

5. **Реализация форм согласно варианту**

6. **Создание тестов**

7. **Оформление README.md**

### **Пример README.md:**

```markdown
# Практическая работа №9: Формы и валидация в Angular

## Вариант 1: Многошаговая форма регистрации

### Задание:
Создать многошаговую форму регистрации с комплексной валидацией

### Реализованные функции:
- ✅ 4-шаговая форма (Личные данные, Аккаунт, Адрес, Настройки)
- ✅ Reactive Forms с кастомными валидаторами
- ✅ Валидация пароля с индикатором сложности
- ✅ Валидация даты рождения и возраста
- ✅ Валидация на уровне формы
- ✅ Визуальный прогресс и навигация
- ✅ Обработка ошибок и состояний

### Использованные техники:
- Reactive Forms с FormBuilder
- Кастомные синхронные валидаторы
- Валидаторы на уровне формы
- FormGroup и FormControl
- Многошаговая навигация

### Скриншоты:

![Шаг 1 - Личные данные](./assets/images/step1.png)
![Шаг 2 - Аккаунт](./assets/images/step2.png)
![Шаг 3 - Адрес](./assets/images/step3.png)
![Шаг 4 - Настройки](./assets/images/step4.png)

### Запуск проекта:
```bash
npm install
ng serve
```

### Структура формы:
```
RegistrationForm
├── personalInfo (FormGroup)
├── accountInfo (FormGroup)
│   └── passwords (FormGroup)
├── address (FormGroup)
└── preferences (FormGroup)
```
```