# Практическая работа. Создание пользовательских директив в Angular

### **Тема:** Создание и применение атрибутных и структурных директив

### **Цель:** 
Научиться создавать пользовательские директивы в Angular для добавления кастомного поведения элементам. Освоить создание атрибутных директив для изменения внешнего вида и поведения, и структурных директив для манипуляции DOM.

### **Теоретическая часть:**

**Директивы** - это классы, которые добавляют дополнительное поведение элементам в Angular.

**Типы директив:**
- **Компоненты** - директивы с шаблоном
- **Атрибутные директивы** - меняют внешний вид или поведение элемента
- **Структурные директивы** - меняют структуру DOM

**Создание атрибутной директивы:**
```typescript
import { Directive, ElementRef, Renderer2, HostListener } from '@angular/core';

@Directive({
  selector: '[appHighlight]'
})
export class HighlightDirective {
  constructor(private el: ElementRef, private renderer: Renderer2) {}

  @HostListener('mouseenter') onMouseEnter() {
    this.highlight('yellow');
  }

  @HostListener('mouseleave') onMouseLeave() {
    this.highlight(null);
  }

  private highlight(color: string | null) {
    this.renderer.setStyle(this.el.nativeElement, 'background-color', color);
  }
}
```

**Создание структурной директивы:**
```typescript
import { Directive, Input, TemplateRef, ViewContainerRef } from '@angular/core';

@Directive({
  selector: '[appUnless]'
})
export class UnlessDirective {
  @Input() set appUnless(condition: boolean) {
    if (!condition) {
      this.vcRef.createEmbeddedView(this.templateRef);
    } else {
      this.vcRef.clear();
    }
  }

  constructor(
    private templateRef: TemplateRef<any>,
    private vcRef: ViewContainerRef
  ) {}
}
```

### **Ход работы:**

1. Создать Angular проект для демонстрации директив
2. Создать атрибутные директивы для различных сценариев
3. Создать структурные директивы для управления DOM
4. Реализовать директивы с входными параметрами
5. Добавить обработку событий и взаимодействие
6. Протестировать все директивы
7. Создать демонстрационную страницу
8. Оформить README.md с описанием работы

### **Практический пример:**

**1. Директива для подсветки при наведении:**
```typescript
// highlight-on-hover.directive.ts
import { Directive, ElementRef, Renderer2, HostListener, Input } from '@angular/core';

@Directive({
  selector: '[appHighlightOnHover]',
  standalone: true
})
export class HighlightOnHoverDirective {
  @Input() appHighlightOnHover: string = '#ffffcc'; // Цвет по умолчанию
  @Input() transitionDuration: string = '0.3s'; // Длительность анимации

  private originalBackground: string = '';
  private originalTransition: string = '';

  constructor(private el: ElementRef, private renderer: Renderer2) {
    this.saveOriginalStyles();
  }

  private saveOriginalStyles() {
    const nativeElement = this.el.nativeElement;
    this.originalBackground = getComputedStyle(nativeElement).backgroundColor;
    this.originalTransition = getComputedStyle(nativeElement).transition;
  }

  @HostListener('mouseenter') onMouseEnter() {
    this.applyHighlight();
  }

  @HostListener('mouseleave') onMouseLeave() {
    this.removeHighlight();
  }

  private applyHighlight() {
    this.renderer.setStyle(this.el.nativeElement, 'background-color', this.appHighlightOnHover);
    this.renderer.setStyle(this.el.nativeElement, 'transition', `background-color ${this.transitionDuration} ease`);
    this.renderer.setStyle(this.el.nativeElement, 'cursor', 'pointer');
  }

  private removeHighlight() {
    this.renderer.setStyle(this.el.nativeElement, 'background-color', this.originalBackground);
    this.renderer.setStyle(this.el.nativeElement, 'transition', this.originalTransition);
  }
}
```

**2. Директива для кликов снаружи элемента:**
```typescript
// click-outside.directive.ts
import { Directive, ElementRef, Output, EventEmitter, HostListener } from '@angular/core';

@Directive({
  selector: '[appClickOutside]',
  standalone: true
})
export class ClickOutsideDirective {
  @Output() appClickOutside = new EventEmitter<void>();

  constructor(private elementRef: ElementRef) {}

  @HostListener('document:click', ['$event.target'])
  public onClick(target: any) {
    const clickedInside = this.elementRef.nativeElement.contains(target);
    if (!clickedInside) {
      this.appClickOutside.emit();
    }
  }
}
```

**3. Директива для ограничения ввода:**
```typescript
// input-restriction.directive.ts
import { Directive, ElementRef, HostListener, Input, Renderer2 } from '@angular/core';

@Directive({
  selector: '[appInputRestriction]',
  standalone: true
})
export class InputRestrictionDirective {
  @Input() appInputRestriction: 'numbers' | 'letters' | 'alphanumeric' | 'custom' = 'alphanumeric';
  @Input() customPattern: string = '';
  @Input() maxLength: number = 0;

  constructor(private el: ElementRef, private renderer: Renderer2) {}

  @HostListener('input', ['$event']) onInput(event: Event) {
    const input = event.target as HTMLInputElement;
    let value = input.value;

    // Применяем ограничения по типу
    value = this.applyRestriction(value);

    // Применяем ограничение по длине
    if (this.maxLength > 0 && value.length > this.maxLength) {
      value = value.substring(0, this.maxLength);
    }

    // Обновляем значение
    if (value !== input.value) {
      this.renderer.setProperty(input, 'value', value);
      input.dispatchEvent(new Event('input'));
    }
  }

  @HostListener('keypress', ['$event']) onKeyPress(event: KeyboardEvent) {
    const pattern = this.getPattern();
    
    if (pattern && !pattern.test(event.key)) {
      event.preventDefault();
    }
  }

  private applyRestriction(value: string): string {
    const pattern = this.getPattern();
    if (!pattern) return value;

    return value.split('').filter(char => pattern.test(char)).join('');
  }

  private getPattern(): RegExp | null {
    switch (this.appInputRestriction) {
      case 'numbers':
        return /[0-9]/;
      case 'letters':
        return /[a-zA-Zа-яА-Я]/;
      case 'alphanumeric':
        return /[a-zA-Zа-яА-Я0-9]/;
      case 'custom':
        return this.customPattern ? new RegExp(this.customPattern) : null;
      default:
        return null;
    }
  }
}
```

**4. Директива для загрузки изображений с прелоадером:**
```typescript
// image-loader.directive.ts
import { Directive, ElementRef, Renderer2, Input, HostListener } from '@angular/core';

@Directive({
  selector: '[appImageLoader]',
  standalone: true
})
export class ImageLoaderDirective {
  @Input() appImageLoader: string = ''; // URL изображения
  @Input() placeholder: string = 'assets/images/placeholder.jpg';
  @Input() errorImage: string = 'assets/images/error.jpg';

  private imgElement: HTMLImageElement;
  private spinnerElement: HTMLElement | null = null;

  constructor(private el: ElementRef, private renderer: Renderer2) {
    this.imgElement = this.el.nativeElement;
    this.setupLoading();
  }

  ngOnChanges() {
    if (this.appImageLoader) {
      this.loadImage();
    }
  }

  private setupLoading() {
    // Устанавливаем placeholder
    this.renderer.setAttribute(this.imgElement, 'src', this.placeholder);
    
    // Создаем спиннер загрузки
    this.createSpinner();
  }

  private loadImage() {
    this.showSpinner();
    
    const img = new Image();
    img.onload = () => {
      this.renderer.setAttribute(this.imgElement, 'src', this.appImageLoader);
      this.hideSpinner();
    };
    
    img.onerror = () => {
      this.renderer.setAttribute(this.imgElement, 'src', this.errorImage);
      this.hideSpinner();
    };
    
    img.src = this.appImageLoader;
  }

  private createSpinner() {
    this.spinnerElement = this.renderer.createElement('div');
    this.renderer.addClass(this.spinnerElement, 'image-spinner');
    this.renderer.setStyle(this.spinnerElement, 'position', 'absolute');
    this.renderer.setStyle(this.spinnerElement, 'top', '50%');
    this.renderer.setStyle(this.spinnerElement, 'left', '50%');
    this.renderer.setStyle(this.spinnerElement, 'transform', 'translate(-50%, -50%)');
    this.renderer.setStyle(this.spinnerElement, 'width', '30px');
    this.renderer.setStyle(this.spinnerElement, 'height', '30px');
    this.renderer.setStyle(this.spinnerElement, 'border', '3px solid #f3f3f3');
    this.renderer.setStyle(this.spinnerElement, 'border-top', '3px solid #007bff');
    this.renderer.setStyle(this.spinnerElement, 'border-radius', '50%');
    this.renderer.setStyle(this.spinnerElement, 'animation', 'spin 1s linear infinite');
    
    this.renderer.setStyle(this.imgElement, 'position', 'relative');
    this.renderer.appendChild(this.el.nativeElement.parentNode, this.spinnerElement);
    this.hideSpinner();
  }

  private showSpinner() {
    if (this.spinnerElement) {
      this.renderer.setStyle(this.spinnerElement, 'display', 'block');
    }
  }

  private hideSpinner() {
    if (this.spinnerElement) {
      this.renderer.setStyle(this.spinnerElement, 'display', 'none');
    }
  }

  @HostListener('load') onImageLoad() {
    this.hideSpinner();
  }

  @HostListener('error') onImageError() {
    this.renderer.setAttribute(this.imgElement, 'src', this.errorImage);
    this.hideSpinner();
  }
}
```

**5. Структурная директива для проверки прав доступа:**
```typescript
// has-role.directive.ts
import { Directive, Input, TemplateRef, ViewContainerRef } from '@angular/core';

interface User {
  roles: string[];
  permissions: string[];
}

@Directive({
  selector: '[appHasRole]',
  standalone: true
})
export class HasRoleDirective {
  private currentUser: User = {
    roles: ['user', 'editor'],
    permissions: ['read', 'write']
  };

  private hasView = false;

  constructor(
    private templateRef: TemplateRef<any>,
    private viewContainer: ViewContainerRef
  ) {}

  @Input() set appHasRole(roles: string | string[]) {
    const requiredRoles = Array.isArray(roles) ? roles : [roles];
    const hasRole = requiredRoles.some(role => this.currentUser.roles.includes(role));

    if (hasRole && !this.hasView) {
      this.viewContainer.createEmbeddedView(this.templateRef);
      this.hasView = true;
    } else if (!hasRole && this.hasView) {
      this.viewContainer.clear();
      this.hasView = false;
    }
  }

  @Input() set appHasRoleElse(elseTemplate: TemplateRef<any>) {
    // Реализация альтернативного шаблона
  }
}
```

**6. Директива для тултипов:**
```typescript
// tooltip.directive.ts
import { Directive, ElementRef, Input, Renderer2, HostListener, ComponentRef, ViewContainerRef, ComponentFactoryResolver, Injector } from '@angular/core';
import { TooltipComponent } from '../components/tooltip/tooltip.component';

@Directive({
  selector: '[appTooltip]',
  standalone: true
})
export class TooltipDirective {
  @Input() appTooltip: string = '';
  @Input() tooltipPosition: 'top' | 'bottom' | 'left' | 'right' = 'top';
  @Input() tooltipDelay: number = 300;

  private tooltipComponentRef: ComponentRef<TooltipComponent> | null = null;
  private timeoutId: any;

  constructor(
    private elementRef: ElementRef,
    private renderer: Renderer2,
    private viewContainerRef: ViewContainerRef,
    private componentFactoryResolver: ComponentFactoryResolver,
    private injector: Injector
  ) {}

  @HostListener('mouseenter') onMouseEnter() {
    this.timeoutId = setTimeout(() => {
      this.showTooltip();
    }, this.tooltipDelay);
  }

  @HostListener('mouseleave') onMouseLeave() {
    if (this.timeoutId) {
      clearTimeout(this.timeoutId);
    }
    this.hideTooltip();
  }

  @HostListener('click') onClick() {
    this.hideTooltip();
  }

  private showTooltip() {
    if (this.tooltipComponentRef) return;

    const factory = this.componentFactoryResolver.resolveComponentFactory(TooltipComponent);
    this.tooltipComponentRef = this.viewContainerRef.createComponent(factory);
    
    const tooltipInstance = this.tooltipComponentRef.instance;
    tooltipInstance.text = this.appTooltip;
    tooltipInstance.position = this.tooltipPosition;

    this.positionTooltip();
  }

  private hideTooltip() {
    if (this.tooltipComponentRef) {
      this.tooltipComponentRef.destroy();
      this.tooltipComponentRef = null;
    }
  }

  private positionTooltip() {
    if (!this.tooltipComponentRef) return;

    const hostPos = this.elementRef.nativeElement.getBoundingClientRect();
    const tooltipElement = this.tooltipComponentRef.location.nativeElement;
    
    let top, left;

    switch (this.tooltipPosition) {
      case 'top':
        top = hostPos.top - tooltipElement.offsetHeight - 8;
        left = hostPos.left + (hostPos.width - tooltipElement.offsetWidth) / 2;
        break;
      case 'bottom':
        top = hostPos.bottom + 8;
        left = hostPos.left + (hostPos.width - tooltipElement.offsetWidth) / 2;
        break;
      case 'left':
        top = hostPos.top + (hostPos.height - tooltipElement.offsetHeight) / 2;
        left = hostPos.left - tooltipElement.offsetWidth - 8;
        break;
      case 'right':
        top = hostPos.top + (hostPos.height - tooltipElement.offsetHeight) / 2;
        left = hostPos.right + 8;
        break;
    }

    this.renderer.setStyle(tooltipElement, 'top', `${top}px`);
    this.renderer.setStyle(tooltipElement, 'left', `${left}px`);
  }
}
```

**7. Компонент тултипа:**
```typescript
// tooltip.component.ts
import { Component, Input } from '@angular/core';

@Component({
  selector: 'app-tooltip',
  template: `
    <div class="tooltip" [class]="'tooltip-' + position">
      {{ text }}
      <div class="tooltip-arrow"></div>
    </div>
  `,
  styles: [`
    .tooltip {
      position: fixed;
      background: #333;
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1000;
      max-width: 200px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    
    .tooltip-arrow {
      position: absolute;
      width: 0;
      height: 0;
      border-style: solid;
    }
    
    .tooltip-top .tooltip-arrow {
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 5px 5px 0 5px;
      border-color: #333 transparent transparent transparent;
    }
    
    .tooltip-bottom .tooltip-arrow {
      top: -5px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 0 5px 5px 5px;
      border-color: transparent transparent #333 transparent;
    }
    
    .tooltip-left .tooltip-arrow {
      right: -5px;
      top: 50%;
      transform: translateY(-50%);
      border-width: 5px 0 5px 5px;
      border-color: transparent transparent transparent #333;
    }
    
    .tooltip-right .tooltip-arrow {
      left: -5px;
      top: 50%;
      transform: translateY(-50%);
      border-width: 5px 5px 5px 0;
      border-color: transparent #333 transparent transparent;
    }
  `],
  standalone: true
})
export class TooltipComponent {
  @Input() text: string = '';
  @Input() position: string = 'top';
}
```

**8. Демонстрационный компонент:**
```typescript
// directives-demo.component.ts
import { Component, signal } from '@angular/core';

@Component({
  selector: 'app-directives-demo',
  templateUrl: './directives-demo.component.html',
  styleUrls: ['./directives-demo.component.css'],
  standalone: true,
  imports: [
    HighlightOnHoverDirective,
    ClickOutsideDirective,
    InputRestrictionDirective,
    ImageLoaderDirective,
    HasRoleDirective,
    TooltipDirective
  ]
})
export class DirectivesDemoComponent {
  // Данные для демонстрации
  showDropdown = signal(false);
  userInput = signal('');
  imageUrl = signal('https://picsum.photos/400/300');
  
  // Пример пользователя с ролями
  currentUser = signal({
    name: 'Анна Иванова',
    roles: ['user', 'editor'],
    permissions: ['read', 'write']
  });

  // Методы для демонстрации
  toggleDropdown() {
    this.showDropdown.update(value => !value);
  }

  onDropdownClickOutside() {
    this.showDropdown.set(false);
  }

  onInputChange(value: string) {
    this.userInput.set(value);
  }

  loadNewImage() {
    const randomId = Math.floor(Math.random() * 1000);
    this.imageUrl.set(`https://picsum.photos/400/300?random=${randomId}`);
  }
}
```

```html
<!-- directives-demo.component.html -->
<div class="directives-demo">
  <h1>🛠️ Демонстрация пользовательских директив</h1>

  <!-- Директива подсветки при наведении -->
  <section class="demo-section">
    <h2>1. Подсветка при наведении</h2>
    <div class="demo-grid">
      <div 
        class="demo-card"
        appHighlightOnHover="#e3f2fd"
        [transitionDuration]="'0.2s'"
      >
        💡 Карточка с подсветкой
      </div>
      <div 
        class="demo-card"
        appHighlightOnHover="#fff3e0"
      >
        🎨 Другая подсветка
      </div>
      <button 
        appHighlightOnHover="#f5f5f5"
        class="demo-button"
      >
        🖱️ Кнопка с подсветкой
      </button>
    </div>
  </section>

  <!-- Директива клика снаружи -->
  <section class="demo-section">
    <h2>2. Клик снаружи элемента</h2>
    <div class="dropdown-container">
      <button (click)="toggleDropdown()" class="dropdown-toggle">
        📂 Выпадающее меню {{ showDropdown() ? '▲' : '▼' }}
      </button>
      
      @if (showDropdown()) {
        <div 
          class="dropdown-menu"
          appClickOutside
          (appClickOutside)="onDropdownClickOutside()"
        >
          <div class="dropdown-item">📄 Пункт 1</div>
          <div class="dropdown-item">📄 Пункт 2</div>
          <div class="dropdown-item">📄 Пункт 3</div>
        </div>
      }
    </div>
  </section>

  <!-- Директива ограничения ввода -->
  <section class="demo-section">
    <h2>3. Ограничение ввода</h2>
    <div class="input-demo">
      <div class="input-group">
        <label>Только цифры:</label>
        <input 
          type="text"
          [value]="userInput()"
          (input)="onInputChange($any($event.target).value)"
          appInputRestriction="numbers"
          [maxLength]="10"
          placeholder="Введите только цифры"
        >
      </div>
      
      <div class="input-group">
        <label>Только буквы:</label>
        <input 
          type="text"
          appInputRestriction="letters"
          placeholder="Введите только буквы"
        >
      </div>
      
      <div class="input-group">
        <label>Кастомный паттерн (только a,b,c):</label>
        <input 
          type="text"
          appInputRestriction="custom"
          [customPattern]="'[abc]'"
          placeholder="Только a, b, c"
        >
      </div>
    </div>
  </section>

  <!-- Директива загрузки изображений -->
  <section class="demo-section">
    <h2>4. Загрузка изображений с прелоадером</h2>
    <div class="image-demo">
      <img 
        [appImageLoader]="imageUrl()"
        [placeholder]="'assets/images/placeholder.jpg'"
        [errorImage]="'assets/images/error.jpg'"
        alt="Демонстрационное изображение"
        class="demo-image"
      >
      <button (click)="loadNewImage()" class="load-image-btn">
        🔄 Загрузить новое изображение
      </button>
    </div>
  </section>

  <!-- Структурная директива проверки прав -->
  <section class="demo-section">
    <h2>5. Проверка прав доступа</h2>
    <div class="permissions-demo">
      <div *appHasRole="'admin'" class="permission-item">
        🔐 Видно только администраторам
      </div>
      
      <div *appHasRole="['admin', 'editor']" class="permission-item">
        ✏️ Видно редакторам и администраторам
      </div>
      
      <div *appHasRole="'user'" class="permission-item">
        👤 Видно всем пользователям
      </div>
    </div>
  </section>

  <!-- Директива тултипов -->
  <section class="demo-section">
    <h2>6. Тултипы</h2>
    <div class="tooltip-demo">
      <button 
        appTooltip="Это простая подсказка"
        tooltipPosition="top"
        class="tooltip-button"
      >
        🔝 Тултип сверху
      </button>
      
      <button 
        appTooltip="Подсказка справа с задержкой"
        tooltipPosition="right"
        [tooltipDelay]="500"
        class="tooltip-button"
      >
        ➡️ Тултип справа
      </button>
      
      <button 
        appTooltip="Подсказка снизу"
        tooltipPosition="bottom"
        class="tooltip-button"
      >
        🔽 Тултип снизу
      </button>
      
      <button 
        appTooltip="Подсказка слева"
        tooltipPosition="left"
        class="tooltip-button"
      >
        ⬅️ Тултип слева
      </button>
    </div>
  </section>
</div>
```

```css
/* directives-demo.component.css */
.directives-demo {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.demo-section {
  background: white;
  margin-bottom: 30px;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  border-left: 4px solid #007bff;
}

.demo-section h2 {
  margin: 0 0 20px 0;
  color: #2c3e50;
  font-size: 1.4em;
  border-bottom: 2px solid #ecf0f1;
  padding-bottom: 10px;
}

/* Стили для демонстрации подсветки */
.demo-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.demo-card {
  padding: 20px;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  text-align: center;
  font-weight: 500;
  transition: all 0.3s ease;
}

.demo-button {
  padding: 12px 24px;
  border: 2px solid #007bff;
  background: white;
  color: #007bff;
  border-radius: 6px;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.demo-button:hover {
  background: #007bff;
  color: white;
}

/* Стили для выпадающего меню */
.dropdown-container {
  position: relative;
  display: inline-block;
}

.dropdown-toggle {
  padding: 10px 20px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
}

.dropdown-menu {
  position: absolute;
  top: 100%;
  left: 0;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  min-width: 200px;
  z-index: 100;
  margin-top: 5px;
}

.dropdown-item {
  padding: 12px 16px;
  cursor: pointer;
  border-bottom: 1px solid #f8f9fa;
  transition: background-color 0.2s;
}

.dropdown-item:hover {
  background: #f8f9fa;
}

.dropdown-item:last-child {
  border-bottom: none;
}

/* Стили для полей ввода */
.input-demo {
  display: grid;
  gap: 20px;
}

.input-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.input-group label {
  font-weight: 600;
  color: #495057;
}

.input-group input {
  padding: 10px 12px;
  border: 2px solid #e9ecef;
  border-radius: 6px;
  font-size: 16px;
  transition: border-color 0.3s;
}

.input-group input:focus {
  outline: none;
  border-color: #007bff;
}

/* Стили для изображений */
.image-demo {
  text-align: center;
}

.demo-image {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  margin-bottom: 15px;
}

.load-image-btn {
  padding: 10px 20px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  transition: background-color 0.3s;
}

.load-image-btn:hover {
  background: #218838;
}

/* Стили для проверки прав */
.permissions-demo {
  display: grid;
  gap: 10px;
}

.permission-item {
  padding: 15px;
  border-radius: 6px;
  background: #e7f3ff;
  border-left: 4px solid #007bff;
}

/* Стили для тултипов */
.tooltip-demo {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
}

.tooltip-button {
  padding: 12px 16px;
  background: #6c757d;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.3s;
}

.tooltip-button:hover {
  background: #5a6268;
}

/* Анимация спиннера */
@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Адаптивность */
@media (max-width: 768px) {
  .demo-grid {
    grid-template-columns: 1fr;
  }
  
  .tooltip-demo {
    grid-template-columns: 1fr;
  }
  
  .directives-demo {
    padding: 10px;
  }
}
```

---

## **Варианты заданий:**

### **Вариант 1: Директивы для формы**
Создайте директивы для:
- Валидации email
- Подтверждения пароля
- Маски ввода телефона
- Кастомного селекта

### **Вариант 2: Директивы для UI/UX**
Создайте директивы для:
- Ленивой загрузки изображений
- Бесконечного скролла
- Drag & drop
- Анимации появления

### **Вариант 3: Директивы для работы с текстом**
Создайте директивы для:
- Обрезки длинного текста
- Подсветки синтаксиса
- Преобразования Markdown
- Чтения вслух (text-to-speech)

### **Вариант 4: Директивы для медиа**
Создайте директивы для:
- Видеоплеера
- Аудиоплеера
- Галереи изображений
- Карусели контента

### **Вариант 5: Директивы для безопасности**
Создайте директивы для:
- Защиты от XSS
- Лимита запросов
- Проверки CAPTCHA
- Валидации файлов

### **Вариант 6: Директивы для аналитики**
Создайте директивы для:
- Отслеживания кликов
- Времени на странице
- Прокрутки страницы
- Отслеживания ошибок

### **Вариант 7: Директивы для доступности**
Создайте директивы для:
- Screen reader
- Управления с клавиатуры
- Высокой контрастности
- Увеличения текста

### **Вариант 8: Директивы для геолокации**
Создайте директивы для:
- Определения местоположения
- Отображения на карте
- Расчет расстояний
- Гео-ограничений

### **Вариант 9: Директивы для работы с файлами**
Создайте директивы для:
- Загрузки файлов
- Предпросмотра файлов
- Перетаскивания файлов
- Валидации размера

### **Вариант 10: Директивы для чата**
Создайте директивы для:
- Отображения сообщений
- Скролла к новым сообщениям
- Форматирования текста
- Временных меток

### **Вариант 11: Директивы для календаря**
Создайте директивы для:
- Выбора даты
- Отображения событий
- Праздничных дней
- Планирования

### **Вариант 12: Директивы для таблиц**
Создайте директивы для:
- Сортировки данных
- Фильтрации строк
- Пагинации
- Редактирования ячеек

### **Вариант 13: Директивы для графиков**
Создайте директивы для:
- Отображения диаграмм
- Интерактивности
- Анимации данных
- Экспорта графиков

### **Вариант 14: Директивы для уведомлений**
Создайте директивы для:
- Toast уведомлений
- Системных оповещений
- Push-уведомлений
- Статусов онлайн

### **Вариант 15: Директивы для игр**
Создайте директивы для:
- Игрового таймера
- Счета очков
- Анимации спрайтов
- Коллизий объектов

---

## **Критерии оценки:**

### **5 (Отлично):**
- Созданы все требуемые директивы согласно варианту
- Корректная работа атрибутных и структурных директив
- Оптимальная производительность
- Полная обработка edge cases
- Качественные тесты для всех директив
- Полная документация

### **4 (Хорошо):**
- Созданы основные директивы
- Правильное применение HostListener/HostBinding
- Хорошая производительность
- Базовая обработка ошибок
- Основные тесты написаны

### **3 (Удовлетворительно):**
- Созданы базовые директивы
- Есть ошибки в логике директив
- Проблемы с производительностью
- Неполная обработка ошибок

### **2 (Неудовлетворительно):**
- Директивы не созданы или не работают
- Критические ошибки в логике
- Отсутствие обработки ошибок
- Код не соответствует требованиям

---

## **Контрольные вопросы:**

1. В чем разница между атрибутными и структурными директивами?
2. Когда использовать Renderer2 вместо прямого доступа к DOM?
3. Как оптимизировать производительность директив?
4. Какие ограничения у структурных директив?
5. Как тестировать пользовательские директивы?
6. Когда использовать директивы vs компоненты?
7. Как передавать multiple параметров в директивы?
8. Какие лучшие практики создания директив?
9. Как обрабатывать ошибки в директивах?
10. Когда использовать ViewContainerRef и TemplateRef?

---

## **Инструкция по выполнению:**

1. **Создание проекта:**
```bash
ng new directives-practice --standalone
cd directives-practice
```

2. **Создание директив:**
```bash
ng generate directive directives/highlight-on-hover --standalone
ng generate directive directives/click-outside --standalone
ng generate directive directives/input-restriction --standalone
```

3. **Реализация директив согласно варианту**

4. **Создание демонстрационных компонентов**

5. **Написание тестов для директив**

6. **Оформление README.md**

### **Пример README.md:**

```markdown
# Практическая работа №7: Пользовательские директивы в Angular

## Вариант 1: Директивы для улучшения пользовательского опыта

### Задание:
Создать набор директив для улучшения UX веб-приложения

### Реализованные директивы:
- ✅ `appHighlightOnHover` - подсветка элементов при наведении
- ✅ `appClickOutside` - обработка кликов вне элемента
- ✅ `appInputRestriction` - ограничение ввода данных
- ✅ `appImageLoader` - загрузка изображений с прелоадером
- ✅ `appHasRole` - структурная директива проверки прав
- ✅ `appTooltip` - кастомные тултипы

### Использованные техники:
- HostListener для обработки событий
- Renderer2 для безопасной работы с DOM
- Structural directives для управления DOM
- ComponentRef для динамических компонентов

### Скриншоты:

![Демонстрация директив](./assets/images/directives-demo.png)

### Примеры использования:
```html
<div appHighlightOnHover="#f0f8ff">Подсветка при наведении</div>

<div appClickOutside (appClickOutside)="closeMenu()">Меню</div>

<input appInputRestriction="numbers" [maxLength]="10">

<img [appImageLoader]="imageUrl" [placeholder]="placeholder">

<div *appHasRole="'admin'">Только для админов</div>

<button appTooltip="Подсказка">Кнопка с тултипом</button>
```

### Запуск проекта:
```bash
npm install
ng serve
```
```