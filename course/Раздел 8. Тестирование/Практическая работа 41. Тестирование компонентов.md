# Практическая работа. Тестирование компонентов в Angular

## Тема
Тестирование Angular компонентов с использованием Jasmine и Karma

## Цель
Научиться писать unit-тесты для Angular компонентов, покрывать основные сценарии использования и обрабатывать пользовательские события.

## Теоретическая часть

### Основные концепции тестирования в Angular

**Jasmine** - фреймворк для поведения-ориентированного тестирования (BDT)
**Karma** - test runner для выполнения тестов в браузере
**TestBed** - утилита для конфигурации модуля тестирования

### Структура теста компонента

```typescript
describe('ComponentName', () => {
  let component: ComponentName;
  let fixture: ComponentFixture<ComponentName>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [ComponentName]
    }).compileComponents();

    fixture = TestBed.createComponent(ComponentName);
    component = fixture.componentInstance;
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});
```

## Практический пример

### Компонент для тестирования: CounterComponent

**counter.component.ts**
```typescript
import { Component } from '@angular/core';

@Component({
  selector: 'app-counter',
  template: `
    <div class="counter">
      <h2>Счетчик: {{ count }}</h2>
      <button (click)="increment()">Увеличить</button>
      <button (click)="decrement()">Уменьшить</button>
      <button (click)="reset()">Сбросить</button>
    </div>
  `,
  styles: [`
    .counter { text-align: center; margin: 20px; }
    button { margin: 5px; padding: 10px; }
  `]
})
export class CounterComponent {
  count = 0;

  increment(): void {
    this.count++;
  }

  decrement(): void {
    this.count--;
  }

  reset(): void {
    this.count = 0;
  }
}
```

**counter.component.spec.ts**
```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { CounterComponent } from './counter.component';

describe('CounterComponent', () => {
  let component: CounterComponent;
  let fixture: ComponentFixture<CounterComponent>;
  let compiled: HTMLElement;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [CounterComponent]
    }).compileComponents();

    fixture = TestBed.createComponent(CounterComponent);
    component = fixture.componentInstance;
    compiled = fixture.nativeElement;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should start with count 0', () => {
    expect(component.count).toBe(0);
    expect(compiled.querySelector('h2')?.textContent).toContain('Счетчик: 0');
  });

  it('should increment count', () => {
    component.increment();
    expect(component.count).toBe(1);
    
    fixture.detectChanges();
    expect(compiled.querySelector('h2')?.textContent).toContain('Счетчик: 1');
  });

  it('should decrement count', () => {
    component.decrement();
    expect(component.count).toBe(-1);
    
    fixture.detectChanges();
    expect(compiled.querySelector('h2')?.textContent).toContain('Счетчик: -1');
  });

  it('should reset count', () => {
    component.count = 5;
    component.reset();
    expect(component.count).toBe(0);
    
    fixture.detectChanges();
    expect(compiled.querySelector('h2')?.textContent).toContain('Счетчик: 0');
  });

  it('should handle button clicks', () => {
    const buttons = compiled.querySelectorAll('button');
    const incrementButton = buttons[0];
    const decrementButton = buttons[1];
    const resetButton = buttons[2];

    // Test increment button
    incrementButton.click();
    fixture.detectChanges();
    expect(component.count).toBe(1);
    expect(compiled.querySelector('h2')?.textContent).toContain('Счетчик: 1');

    // Test decrement button
    decrementButton.click();
    fixture.detectChanges();
    expect(component.count).toBe(0);
    expect(compiled.querySelector('h2')?.textContent).toContain('Счетчик: 0');

    // Test reset button
    component.count = 10;
    fixture.detectChanges();
    resetButton.click();
    fixture.detectChanges();
    expect(component.count).toBe(0);
    expect(compiled.querySelector('h2')?.textContent).toContain('Счетчик: 0');
  });
});
```

## Ход работы

1. Создать новый Angular проект
2. Реализовать компонент согласно вашему варианту
3. Написать comprehensive тесты для компонента
4. Запустить тесты и убедиться в их прохождении
5. Сделать скриншоты работы программы
6. Оформить README.md
7. Загрузить на Gogs

## Варианты заданий

### Вариант 1: Компонент "Список задач"
Создать компонент для управления списком задач с добавлением, удалением и отметкой выполнения.

### Вариант 2: Компонент "Таймер"
Создать компонент таймера с запуском, паузой и сбросом.

### Вариант 3: Компонент "Калькулятор"
Создать простой калькулятор с базовыми арифметическими операциями.

### Вариант 4: Компонент "Форма входа"
Создать форму входа с валидацией email и пароля.

### Вариант 5: Компонент "Погода"
Создать компонент отображения погоды с переключением между городами.

### Вариант 6: Компонент "Карусель изображений"
Создать карусель для переключения между изображениями.

### Вариант 7: Компонент "Прогресс бар"
Создать анимированный прогресс бар с управлением.

### Вариант 8: Компонент "Рейтинг"
Создать компонент оценки с звездами.

### Вариант 9: Компонент "Поиск"
Создать компонент поиска с фильтрацией результатов.

### Вариант 10: Компонент "Уведомления"
Создать систему уведомлений с разными типами сообщений.

### Вариант 11: Компонент "Аккордеон"
Создать аккордеон с раскрывающимися секциями.

### Вариант 12: Компонент "Вкладки"
Создать компонент вкладок с переключением контента.

### Вариант 13: Компонент "Модальное окно"
Создать переиспользуемое модальное окно.

### Вариант 14: Компонент "Хлебные крошки"
Создать навигационные хлебные крошки.

### Вариант 15: Компонент "Пагинация"
Создать компонент пагинации для больших списков.

## Критерии оценки

**5 (Отлично):**
- Все тесты проходят успешно
- Полное покрытие функциональности компонента
- Тестирование пользовательских событий
- Проверка отображения в DOM
- Правильная обработка граничных случаев
- Чистый и читаемый код

**4 (Хорошо):**
- Большинство тестов проходят
- Хорошее покрытие основной функциональности
- Тестирование основных пользовательских событий
- Незначительные недочеты в тестах

**3 (Удовлетворительно):**
- Базовые тесты работают
- Частичное покрытие функциональности
- Отсутствие тестирования некоторых сценариев

**2 (Неудовлетворительно):**
- Тесты не проходят или отсутствуют
- Критические ошибки в реализации
- Невыполнение основных требований

## Контрольные вопросы

1. Что такое TestBed и для чего он используется?
2. Как протестировать обработчик клика в компоненте?
3. Что такое fixture и componentInstance?
4. Как проверить отображение данных в шаблоне?
5. Какие методы жизненного цикла компонента важно тестировать?
6. Как тестировать компоненты с @Input и @Output?
7. Что такое spy в Jasmine и для чего используется?
8. Как тестировать асинхронные операции в компонентах?
9. Какие best practices для тестирования Angular компонентов?
10. Как организовать структуру тестов для сложных компонентов?

---

# Пример README.md для варианта 1

```markdown
# Практическая работа №X: Тестирование компонентов в Angular

**Номер варианта:** 1  
**Тема:** Компонент "Список задач"

## Задание

Создать компонент для управления списком задач с следующими функциями:
- Добавление новой задачи
- Удаление задачи
- Отметка задачи как выполненной
- Отображение счетчика выполненных задач

## Реализация

### Код компонента

**todo-list.component.ts**
```typescript
import { Component } from '@angular/core';

export interface Todo {
  id: number;
  title: string;
  completed: boolean;
}

@Component({
  selector: 'app-todo-list',
  templateUrl: './todo-list.component.html',
  styleUrls: ['./todo-list.component.css']
})
export class TodoListComponent {
  todos: Todo[] = [];
  newTodoTitle = '';

  addTodo(): void {
    if (this.newTodoTitle.trim()) {
      const newTodo: Todo = {
        id: Date.now(),
        title: this.newTodoTitle.trim(),
        completed: false
      };
      this.todos.push(newTodo);
      this.newTodoTitle = '';
    }
  }

  deleteTodo(id: number): void {
    this.todos = this.todos.filter(todo => todo.id !== id);
  }

  toggleTodo(id: number): void {
    const todo = this.todos.find(t => t.id === id);
    if (todo) {
      todo.completed = !todo.completed;
    }
  }

  get completedCount(): number {
    return this.todos.filter(todo => todo.completed).length;
  }
}
```

**todo-list.component.html**
```html
<div class="todo-container">
  <h2>Список задач</h2>
  
  <div class="add-todo">
    <input 
      [(ngModel)]="newTodoTitle" 
      (keyup.enter)="addTodo()"
      placeholder="Введите новую задачу">
    <button (click)="addTodo()">Добавить</button>
  </div>

  <div class="stats">
    Выполнено: {{ completedCount }} из {{ todos.length }}
  </div>

  <div class="todo-list">
    <div 
      *ngFor="let todo of todos" 
      class="todo-item"
      [class.completed]="todo.completed">
      
      <input 
        type="checkbox" 
        [checked]="todo.completed"
        (change)="toggleTodo(todo.id)">
      
      <span class="todo-title">{{ todo.title }}</span>
      
      <button 
        class="delete-btn"
        (click)="deleteTodo(todo.id)">
        Удалить
      </button>
    </div>
  </div>
</div>
```

### Тесты

**todo-list.component.spec.ts**
```typescript
import { ComponentFixture, TestBed } from '@angular/core/testing';
import { FormsModule } from '@angular/forms';
import { TodoListComponent, Todo } from './todo-list.component';

describe('TodoListComponent', () => {
  let component: TodoListComponent;
  let fixture: ComponentFixture<TodoListComponent>;
  let compiled: HTMLElement;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      declarations: [TodoListComponent],
      imports: [FormsModule]
    }).compileComponents();

    fixture = TestBed.createComponent(TodoListComponent);
    component = fixture.componentInstance;
    compiled = fixture.nativeElement;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });

  it('should add new todo', () => {
    const initialLength = component.todos.length;
    component.newTodoTitle = 'Test task';
    component.addTodo();
    
    expect(component.todos.length).toBe(initialLength + 1);
    expect(component.todos[0].title).toBe('Test task');
    expect(component.todos[0].completed).toBe(false);
  });

  it('should not add empty todo', () => {
    const initialLength = component.todos.length;
    component.newTodoTitle = '   ';
    component.addTodo();
    
    expect(component.todos.length).toBe(initialLength);
  });

  it('should delete todo', () => {
    component.todos = [
      { id: 1, title: 'Task 1', completed: false },
      { id: 2, title: 'Task 2', completed: false }
    ];
    
    component.deleteTodo(1);
    
    expect(component.todos.length).toBe(1);
    expect(component.todos[0].id).toBe(2);
  });

  it('should toggle todo completion', () => {
    const todo: Todo = { id: 1, title: 'Test task', completed: false };
    component.todos = [todo];
    
    component.toggleTodo(1);
    expect(todo.completed).toBe(true);
    
    component.toggleTodo(1);
    expect(todo.completed).toBe(false);
  });

  it('should calculate completed count', () => {
    component.todos = [
      { id: 1, title: 'Task 1', completed: true },
      { id: 2, title: 'Task 2', completed: false },
      { id: 3, title: 'Task 3', completed: true }
    ];
    
    expect(component.completedCount).toBe(2);
  });

  it('should render todos in template', () => {
    component.todos = [
      { id: 1, title: 'First task', completed: false },
      { id: 2, title: 'Second task', completed: true }
    ];
    
    fixture.detectChanges();
    
    const todoElements = compiled.querySelectorAll('.todo-item');
    expect(todoElements.length).toBe(2);
    
    const completedElement = compiled.querySelector('.todo-item.completed');
    expect(completedElement).toBeTruthy();
  });
});
```

## Скриншоты работы программы

![Главный экран](images/main-screen.png)
*Главный экран приложения*

![Добавление задачи](images/add-task.png)
*Добавление новой задачи*

![Выполненная задача](images/completed-task.png)
*Отметка задачи как выполненной*

## Запуск тестов

```bash
ng test
```

Все тесты должны проходить успешно.
```

## Структура репозитория Gogs

```
practical-work-testing/
├── src/
│   ├── app/
│   │   ├── components/
│   │   │   ├── todo-list/
│   │   │   │   ├── todo-list.component.ts
│   │   │   │   ├── todo-list.component.html
│   │   │   │   ├── todo-list.component.css
│   │   │   │   └── todo-list.component.spec.ts
│   │   │   └── ...
│   │   └── app.module.ts
├── images/
│   ├── main-screen.png
│   ├── add-task.png
│   └── completed-task.png
├── README.md
└── package.json
```
