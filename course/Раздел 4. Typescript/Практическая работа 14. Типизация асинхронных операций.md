# –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ 14. –¢–∏–ø–∏–∑–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ TypeScript

## –¢–µ–º–∞
–¢–∏–ø–∏–∑–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ TypeScript

## –¶–µ–ª—å
–û—Å–≤–æ–∏—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ TypeScript, –Ω–∞—É—á–∏—Ç—å—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å Promise, async/await, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ, —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API –∑–∞–ø—Ä–æ—Å—ã –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ TypeScript
- **Promise** - —Ç–∏–ø–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–∏—Å–æ–≤ —Å Generic —Ç–∏–ø–∞–º–∏
- **async/await** - —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ try/catch
- **Promise –º–µ—Ç–æ–¥—ã** - Promise.all, Promise.race, Promise.allSettled
- **AbortController** - –æ—Ç–º–µ–Ω–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –¢–∏–ø–∏–∑–∞—Ü–∏—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- **Fetch API** - —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
- **REST API** - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- **–°—Ç–∞—Ç—É—Å—ã –æ—Ç–≤–µ—Ç–æ–≤** - —Ç–∏–ø–∏–∑–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ API

### –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏
- **Generic —Ç–∏–ø—ã** –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–£—Å–ª–æ–≤–Ω—ã–µ —Ç–∏–ø—ã** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ä–∞–∑–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
- **–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π** –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
- **Type Guards** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –≤ runtime

## –•–æ–¥ —Ä–∞–±–æ—Ç—ã

1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—é
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
5. –û—Ñ–æ—Ä–º–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ README.md
6. –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä

```typescript
// –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–ª—è API
interface User {
    id: number;
    name: string;
    email: string;
    website: string;
}

interface Post {
    id: number;
    userId: number;
    title: string;
    body: string;
}

interface Comment {
    id: number;
    postId: number;
    name: string;
    email: string;
    body: string;
}

// –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
class JSONPlaceholderAPI {
    private readonly baseUrl: string = 'https://jsonplaceholder.typicode.com';

    // –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è GET –∑–∞–ø—Ä–æ—Å–æ–≤
    private async fetchData<T>(endpoint: string): Promise<T> {
        const response = await fetch(`${this.baseUrl}${endpoint}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json() as T;
    }

    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
    public async getUsers(): Promise<User[]> {
        return this.fetchData<User[]>('/users');
    }

    public async getUserById(id: number): Promise<User> {
        return this.fetchData<User>(`/users/${id}`);
    }

    public async getPosts(): Promise<Post[]> {
        return this.fetchData<Post[]>('/posts');
    }

    public async getPostsByUserId(userId: number): Promise<Post[]> {
        return this.fetchData<Post[]>(`/users/${userId}/posts`);
    }

    public async getCommentsByPostId(postId: number): Promise<Comment[]> {
        return this.fetchData<Comment[]>(`/posts/${postId}/comments`);
    }

    // –ú–µ—Ç–æ–¥ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
    public async getUserWithPosts(userId: number): Promise<{ user: User; posts: Post[] }> {
        try {
            const [user, posts] = await Promise.all([
                this.getUserById(userId),
                this.getPostsByUserId(userId)
            ]);

            return { user, posts };
        } catch (error) {
            throw new Error(`Failed to fetch user with posts: ${(error as Error).message}`);
        }
    }

    // –ú–µ—Ç–æ–¥ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
    public async getPostsWithComments(): Promise<(Post & { comments: Comment[] })[]> {
        try {
            const posts = await this.getPosts();
            const postsWithComments = await Promise.all(
                posts.slice(0, 5).map(async (post) => {
                    const comments = await this.getCommentsByPostId(post.id);
                    return { ...post, comments };
                })
            );

            return postsWithComments;
        } catch (error) {
            console.error('Error fetching posts with comments:', error);
            return [];
        }
    }
}

// –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
interface AsyncState<T> {
    data: T | null;
    loading: boolean;
    error: string | null;
}

class AsyncDataManager<T> {
    private state: AsyncState<T> = {
        data: null,
        loading: false,
        error: null
    };

    private abortController: AbortController | null = null;

    public async fetchData(
        fetchFn: (signal?: AbortSignal) => Promise<T>,
        onUpdate?: (state: AsyncState<T>) => void
    ): Promise<void> {
        // –û—Ç–º–µ–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–∞–ø—Ä–æ—Å
        if (this.abortController) {
            this.abortController.abort();
        }

        this.abortController = new AbortController();
        
        this.setState({ loading: true, error: null }, onUpdate);

        try {
            const data = await fetchFn(this.abortController.signal);
            this.setState({ data, loading: false, error: null }, onUpdate);
        } catch (error) {
            if ((error as Error).name !== 'AbortError') {
                this.setState({ 
                    loading: false, 
                    error: (error as Error).message 
                }, onUpdate);
            }
        }
    }

    public cancel(): void {
        if (this.abortController) {
            this.abortController.abort();
        }
    }

    private setState(
        updates: Partial<AsyncState<T>>, 
        onUpdate?: (state: AsyncState<T>) => void
    ): void {
        this.state = { ...this.state, ...updates };
        if (onUpdate) {
            onUpdate(this.state);
        }
    }

    public getState(): AsyncState<T> {
        return this.state;
    }
}

// –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
async function demonstrateAsyncOperations(): Promise<void> {
    const api = new JSONPlaceholderAPI();
    
    try {
        // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        const [users, posts] = await Promise.all([
            api.getUsers(),
            api.getPosts()
        ]);
        
        console.log('Users:', users.length);
        console.log('Posts:', posts.length);

        // –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
        const userWithPosts = await api.getUserWithPosts(1);
        console.log('User with posts:', userWithPosts);

        // –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        const postsWithComments = await api.getPostsWithComments();
        console.log('Posts with comments:', postsWithComments.length);

    } catch (error) {
        console.error('Demonstration failed:', error);
    }
}
```

## –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è (15 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

**–í–∞—Ä–∏–∞–Ω—Ç 1**: –°–æ–∑–¥–∞–π—Ç–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–≥–æ–¥–Ω—ã–º API. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã, –ø—Ä–æ–≥–Ω–æ–∑–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏.

**–í–∞—Ä–∏–∞–Ω—Ç 2**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º (localStorage) —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–º–µ–Ω—ã.

**–í–∞—Ä–∏–∞–Ω—Ç 3**: –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Web File API. –¢–∏–ø–∏–∑–∏—Ä—É–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

**–í–∞—Ä–∏–∞–Ω—Ç 4**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π WebSocket –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π.

**–í–∞—Ä–∏–∞–Ω—Ç 5**: –°–æ–∑–¥–∞–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π. –¢–∏–ø–∏–∑–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ‰ΩçÁΩÆ –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

**–í–∞—Ä–∏–∞–Ω—Ç 6**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º –∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏.

**–í–∞—Ä–∏–∞–Ω—Ç 7**: –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å IndexedDB —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.

**–í–∞—Ä–∏–∞–Ω—Ç 8**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è GitHub API —Å –º–µ—Ç–æ–¥–∞–º–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–í–∞—Ä–∏–∞–Ω—Ç 9**: –°–æ–∑–¥–∞–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ —Ü–µ–ø–æ—á–∫–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫.

**–í–∞—Ä–∏–∞–Ω—Ç 10**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∞—É–¥–∏–æ/–≤–∏–¥–µ–æ API —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏, —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∏ –º–µ—Ç–æ–¥–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

**–í–∞—Ä–∏–∞–Ω—Ç 11**: –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–∞–∫–µ—Ç–Ω—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π –æ—á–µ—Ä–µ–¥–∏.

**–í–∞—Ä–∏–∞–Ω—Ç 12**: –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä RSS –ª–µ–Ω—Ç —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö.

**–í–∞—Ä–∏–∞–Ω—Ç 13**: –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–º–µ—Ä–æ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ MediaDevices API —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π –ø–æ—Ç–æ–∫–æ–≤ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π.

**–í–∞—Ä–∏–∞–Ω—Ç 14**: –†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å TTL (time-to-live) –∏ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

**–í–∞—Ä–∏–∞–Ω—Ç 15**: –°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º API —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, —Å—Ç–∞—Ç—É—Å–∞–º–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π webhook.

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

**5 (–û—Ç–ª–∏—á–Ω–æ)**:
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞–Ω–∏–µ
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —Ç–∏–ø–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ (Generic, Promise.all –∏ —Ç.–¥.)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –æ—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
- –ö–æ–¥ —Ö–æ—Ä–æ—à–æ –æ—Ç–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- README.md –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω

**4 (–•–æ—Ä–æ—à–æ)**:
- –ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ —Å –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º–∏ –Ω–µ–¥–æ—á–µ—Ç–∞–º–∏
- –ù–µ –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- –ù–µ–ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- README.md –∑–∞–ø–æ–ª–Ω–µ–Ω –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é

**3 (–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)**:
- –í—ã–ø–æ–ª–Ω–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å –∑–∞–¥–∞–Ω–∏—è
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- README.md –∑–∞–ø–æ–ª–Ω–µ–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω–æ

**2 (–ù–µ—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ)**:
- –ó–∞–¥–∞–Ω–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
- –ù–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- README.md –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. –ö–∞–∫ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å Promise –≤ TypeScript?
2. –ß–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è async —Ñ—É–Ω–∫—Ü–∏–π –æ—Ç –æ–±—ã—á–Ω—ã—Ö?
3. –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–º –∫–æ–¥–µ —Å TypeScript?
4. –ß—Ç–æ —Ç–∞–∫–æ–µ Generic —Ç–∏–ø—ã –∏ –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å Promise?
5. –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–º–µ–Ω—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π?
6. –ö–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã Promise –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–æ–º–∏—Å–∞–º–∏?
7. –ö–∞–∫ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å HTTP –æ—Ç–≤–µ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏?
8. –ß—Ç–æ —Ç–∞–∫–æ–µ type guards –∏ –∫–∞–∫ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏?
9. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å AbortController –≤ TypeScript?
10. –ö–∞–∫–∏–µ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥–∞?

---

# –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞ 1

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
practical-work-async-ts/
‚îú‚îÄ‚îÄ index.html
‚îú‚îÄ‚îÄ styles.css
‚îú‚îÄ‚îÄ script.ts
‚îú‚îÄ‚îÄ script.js
‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ screenshot1.png
‚îÇ   ‚îî‚îÄ‚îÄ screenshot2.png
‚îî‚îÄ‚îÄ README.md
```

## index.html
```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞ - –¢–∏–ø–∏–∑–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>üå§Ô∏è –ü–æ–≥–æ–¥–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</h1>
        <p class="subtitle">–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ TypeScript</p>
        
        <div class="search-section">
            <div class="input-group">
                <input type="text" id="cityInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞..." value="Moscow">
                <button id="searchBtn" onclick="searchWeather()">–ü–æ–∏—Å–∫</button>
                <button id="currentLocationBtn" onclick="getCurrentLocationWeather()">üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
            </div>
            <div class="loading" id="loadingIndicator" style="display: none;">
                <div class="spinner"></div>
                <span>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
            </div>
        </div>

        <div class="weather-cards">
            <div class="weather-card" id="currentWeatherCard" style="display: none;">
                <h2>–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞</h2>
                <div class="weather-content" id="currentWeatherContent"></div>
            </div>

            <div class="weather-card" id="forecastCard" style="display: none;">
                <h2>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 5 –¥–Ω–µ–π</h2>
                <div class="forecast-content" id="forecastContent"></div>
            </div>
        </div>

        <div class="history-section">
            <h2>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤</h2>
            <button onclick="clearHistory()">–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é</button>
            <div id="historyContainer"></div>
        </div>

        <div class="api-status">
            <h2>–°—Ç–∞—Ç—É—Å API</h2>
            <div class="status-items" id="apiStatus"></div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
```

## styles.css
```css
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

:root {
    --primary: #3498db;
    --secondary: #2c3e50;
    --success: #27ae60;
    --warning: #f39c12;
    --danger: #e74c3c;
    --light: #ecf0f1;
    --dark: #2c3e50;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
    color: #333;
    line-height: 1.6;
    min-height: 100vh;
    padding: 20px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    backdrop-filter: blur(10px);
}

h1 {
    text-align: center;
    color: var(--secondary);
    padding: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    margin-bottom: 0;
    font-size: 2.5rem;
}

.subtitle {
    text-align: center;
    color: #7f8c8d;
    margin-bottom: 30px;
    font-size: 1.1rem;
}

.search-section {
    padding: 30px;
    background: var(--light);
    border-bottom: 1px solid #bdc3c7;
}

.input-group {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

input {
    flex: 1;
    min-width: 250px;
    padding: 15px 20px;
    border: 2px solid #bdc3c7;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: white;
}

input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

button {
    padding: 15px 25px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

#searchBtn {
    background: var(--primary);
    color: white;
}

#currentLocationBtn {
    background: var(--success);
    color: white;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

#searchBtn:hover {
    background: #2980b9;
}

#currentLocationBtn:hover {
    background: #219a52;
}

.loading {
    display: flex;
    align-items: center;
    gap: 15px;
    color: var(--primary);
    font-weight: 600;
}

.spinner {
    width: 20px;
    height: 20px;
    border: 2px solid #f3f3f3;
    border-top: 2px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.weather-cards {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    padding: 30px;
}

.weather-card {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    border: 1px solid #e1e8ed;
}

.weather-card h2 {
    color: var(--secondary);
    margin-bottom: 20px;
    border-bottom: 2px solid var(--primary);
    padding-bottom: 10px;
}

.weather-content {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.weather-item {
    display: flex;
    justify-content: between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid #ecf0f1;
}

.weather-item:last-child {
    border-bottom: none;
}

.weather-label {
    font-weight: 600;
    color: var(--dark);
    min-width: 120px;
}

.weather-value {
    color: var(--secondary);
    font-weight: 500;
}

.temperature {
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary);
}

.forecast-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.forecast-day {
    background: var(--light);
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    transition: transform 0.2s ease;
}

.forecast-day:hover {
    transform: translateY(-3px);
}

.forecast-date {
    font-weight: 600;
    color: var(--dark);
    margin-bottom: 8px;
}

.forecast-temp {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary);
    margin: 5px 0;
}

.forecast-desc {
    font-size: 0.9rem;
    color: #7f8c8d;
}

.history-section, .api-status {
    padding: 30px;
    background: var(--light);
    border-top: 1px solid #bdc3c7;
}

.history-section h2, .api-status h2 {
    color: var(--secondary);
    margin-bottom: 20px;
}

.history-section button {
    background: var(--warning);
    color: white;
    margin-bottom: 20px;
}

.history-section button:hover {
    background: #e67e22;
}

.history-item {
    background: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 8px;
    border-left: 4px solid var(--primary);
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.status-items {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.status-item {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

.status-online {
    border-left: 4px solid var(--success);
}

.status-offline {
    border-left: 4px solid var(--danger);
}

.error-message {
    background: #fadbd8;
    color: var(--danger);
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid var(--danger);
    margin: 10px 0;
}

.success-message {
    background: #d4edda;
    color: var(--success);
    padding: 15px;
    border-radius: 8px;
    border-left: 4px solid var(--success);
    margin: 10px 0;
}

@media (max-width: 768px) {
    .weather-cards {
        grid-template-columns: 1fr;
    }
    
    .input-group {
        flex-direction: column;
    }
    
    input, button {
        min-width: 100%;
    }
    
    .container {
        margin: 10px;
        border-radius: 15px;
    }
    
    h1 {
        font-size: 2rem;
        padding: 20px;
    }
}
```

## script.ts
```typescript
// –¢–∏–ø—ã –¥–ª—è –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
interface WeatherMain {
    temp: number;
    feels_like: number;
    temp_min: number;
    temp_max: number;
    pressure: number;
    humidity: number;
    sea_level?: number;
    grnd_level?: number;
}

interface WeatherDescription {
    id: number;
    main: string;
    description: string;
    icon: string;
}

interface Wind {
    speed: number;
    deg: number;
    gust?: number;
}

interface Clouds {
    all: number;
}

interface SystemInfo {
    type: number;
    id: number;
    country: string;
    sunrise: number;
    sunset: number;
}

interface CurrentWeather {
    coord: {
        lon: number;
        lat: number;
    };
    weather: WeatherDescription[];
    base: string;
    main: WeatherMain;
    visibility: number;
    wind: Wind;
    clouds: Clouds;
    dt: number;
    sys: SystemInfo;
    timezone: number;
    id: number;
    name: string;
    cod: number;
}

interface ForecastItem {
    dt: number;
    main: WeatherMain;
    weather: WeatherDescription[];
    clouds: Clouds;
    wind: Wind;
    visibility: number;
    pop: number;
    sys: {
        pod: string;
    };
    dt_txt: string;
}

interface WeatherForecast {
    cod: string;
    message: number;
    cnt: number;
    list: ForecastItem[];
    city: {
        id: number;
        name: string;
        coord: {
            lat: number;
            lon: number;
        };
        country: string;
        population: number;
        timezone: number;
        sunrise: number;
        sunset: number;
    };
}

interface WeatherHistoryItem {
    city: string;
    timestamp: number;
    temperature: number;
    description: string;
}

// –¢–∏–ø—ã –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
interface WeatherState {
    current: CurrentWeather | null;
    forecast: WeatherForecast | null;
    loading: boolean;
    error: string | null;
    history: WeatherHistoryItem[];
}

// –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Weather API
class WeatherAPI {
    private readonly apiKey: string = 'your_api_key_here'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API –∫–ª—é—á
    private readonly baseUrl: string = 'https://api.openweathermap.org/data/2.5';
    private abortController: AbortController | null = null;

    // –û–±–æ–±—â–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
    private async fetchWithTimeout<T>(
        url: string, 
        timeout: number = 10000
    ): Promise<T> {
        // –°–æ–∑–¥–∞–µ–º AbortController –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–ø—Ä–æ—Å–∞
        this.abortController = new AbortController();
        const timeoutId = setTimeout(() => {
            this.abortController?.abort();
        }, timeout);

        try {
            const response = await fetch(url, {
                signal: this.abortController.signal
            });

            clearTimeout(timeoutId);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data: T = await response.json();
            return data;
        } catch (error) {
            if ((error as Error).name === 'AbortError') {
                throw new Error('Request timeout');
            }
            throw error;
        }
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã
    public async getCurrentWeather(city: string): Promise<CurrentWeather> {
        const url = `${this.baseUrl}/weather?q=${encodeURIComponent(city)}&appid=${this.apiKey}&units=metric&lang=ru`;
        return this.fetchWithTimeout<CurrentWeather>(url);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–≥–æ–¥—ã –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
    public async getCurrentWeatherByCoords(lat: number, lon: number): Promise<CurrentWeather> {
        const url = `${this.baseUrl}/weather?lat=${lat}&lon=${lon}&appid=${this.apiKey}&units=metric&lang=ru`;
        return this.fetchWithTimeout<CurrentWeather>(url);
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã
    public async getWeatherForecast(city: string): Promise<WeatherForecast> {
        const url = `${this.baseUrl}/forecast?q=${encodeURIComponent(city)}&appid=${this.apiKey}&units=metric&lang=ru`;
        return this.fetchWithTimeout<WeatherForecast>(url);
    }

    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞
    public async getCompleteWeatherData(city: string): Promise<{
        current: CurrentWeather;
        forecast: WeatherForecast;
    }> {
        try {
            const [current, forecast] = await Promise.all([
                this.getCurrentWeather(city),
                this.getWeatherForecast(city)
            ]);

            return { current, forecast };
        } catch (error) {
            throw new Error(`Failed to fetch complete weather data: ${(error as Error).message}`);
        }
    }

    // –û—Ç–º–µ–Ω–∞ —Ç–µ–∫—É—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
    public cancelCurrentRequest(): void {
        if (this.abortController) {
            this.abortController.abort();
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
    public async checkAPIStatus(): Promise<boolean> {
        try {
            await this.fetchWithTimeout(`${this.baseUrl}/weather?q=London&appid=${this.apiKey}`, 5000);
            return true;
        } catch {
            return false;
        }
    }
}

// –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class WeatherApp {
    private state: WeatherState = {
        current: null,
        forecast: null,
        loading: false,
        error: null,
        history: this.loadHistory()
    };

    private api: WeatherAPI = new WeatherAPI();

    // –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    public async searchWeather(city: string): Promise<void> {
        this.setLoading(true);
        this.setError(null);

        try {
            const data = await this.api.getCompleteWeatherData(city);
            
            this.setState({
                current: data.current,
                forecast: data.forecast,
                loading: false
            });

            this.addToHistory(city, data.current);
            this.updateDisplay();
        } catch (error) {
            this.setError((error as Error).message);
            this.setLoading(false);
        }
    }

    public async getCurrentLocationWeather(): Promise<void> {
        this.setLoading(true);
        this.setError(null);

        try {
            const position = await this.getCurrentPosition();
            const weather = await this.api.getCurrentWeatherByCoords(
                position.coords.latitude,
                position.coords.longitude
            );

            this.setState({
                current: weather,
                loading: false
            });

            this.addToHistory(weather.name, weather);
            this.updateDisplay();
        } catch (error) {
            this.setError((error as Error).message);
            this.setLoading(false);
        }
    }

    public cancelRequest(): void {
        this.api.cancelCurrentRequest();
        this.setLoading(false);
    }

    public clearHistory(): void {
        this.setState({ history: [] });
        localStorage.removeItem('weatherHistory');
        this.updateHistoryDisplay();
    }

    // –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã
    private setLoading(loading: boolean): void {
        this.state.loading = loading;
        this.updateLoadingDisplay();
    }

    private setError(error: string | null): void {
        this.state.error = error;
        if (error) {
            this.showError(error);
        }
    }

    private setState(updates: Partial<WeatherState>): void {
        this.state = { ...this.state, ...updates };
    }

    private async getCurrentPosition(): Promise<GeolocationPosition> {
        return new Promise((resolve, reject) => {
            if (!navigator.geolocation) {
                reject(new Error('Geolocation is not supported'));
                return;
            }

            navigator.geolocation.getCurrentPosition(resolve, reject, {
                timeout: 10000,
                enableHighAccuracy: true
            });
        });
    }

    private addToHistory(city: string, weather: CurrentWeather): void {
        const historyItem: WeatherHistoryItem = {
            city,
            timestamp: Date.now(),
            temperature: Math.round(weather.main.temp),
            description: weather.weather[0].description
        };

        this.state.history.unshift(historyItem);
        this.state.history = this.state.history.slice(0, 10); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é 10 –∑–∞–ø–∏—Å—è–º–∏
        this.saveHistory();
        this.updateHistoryDisplay();
    }

    private loadHistory(): WeatherHistoryItem[] {
        try {
            const stored = localStorage.getItem('weatherHistory');
            return stored ? JSON.parse(stored) : [];
        } catch {
            return [];
        }
    }

    private saveHistory(): void {
        try {
            localStorage.setItem('weatherHistory', JSON.stringify(this.state.history));
        } catch (error) {
            console.error('Failed to save history:', error);
        }
    }

    // –ú–µ—Ç–æ–¥—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI
    private updateDisplay(): void {
        this.updateCurrentWeatherDisplay();
        this.updateForecastDisplay();
    }

    private updateCurrentWeatherDisplay(): void {
        const card = document.getElementById('currentWeatherCard');
        const content = document.getElementById('currentWeatherContent');

        if (!this.state.current || !card || !content) return;

        const weather = this.state.current;
        card.style.display = 'block';

        content.innerHTML = `
            <div class="weather-item">
                <span class="weather-label">–ì–æ—Ä–æ–¥:</span>
                <span class="weather-value">${weather.name}, ${weather.sys.country}</span>
            </div>
            <div class="weather-item">
                <span class="weather-label">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</span>
                <span class="weather-value temperature">${Math.round(weather.main.temp)}¬∞C</span>
            </div>
            <div class="weather-item">
                <span class="weather-label">–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫:</span>
                <span class="weather-value">${Math.round(weather.main.feels_like)}¬∞C</span>
            </div>
            <div class="weather-item">
                <span class="weather-label">–ü–æ–≥–æ–¥–∞:</span>
                <span class="weather-value">${weather.weather[0].description}</span>
            </div>
            <div class="weather-item">
                <span class="weather-label">–í–ª–∞–∂–Ω–æ—Å—Ç—å:</span>
                <span class="weather-value">${weather.main.humidity}%</span>
            </div>
            <div class="weather-item">
                <span class="weather-label">–í–µ—Ç–µ—Ä:</span>
                <span class="weather-value">${weather.wind.speed} –º/—Å</span>
            </div>
            <div class="weather-item">
                <span class="weather-label">–î–∞–≤–ª–µ–Ω–∏–µ:</span>
                <span class="weather-value">${weather.main.pressure} hPa</span>
            </div>
            <div class="weather-item">
                <span class="weather-label">–í–∏–¥–∏–º–æ—Å—Ç—å:</span>
                <span class="weather-value">${weather.visibility / 1000} –∫–º</span>
            </div>
        `;
    }

    private updateForecastDisplay(): void {
        const card = document.getElementById('forecastCard');
        const content = document.getElementById('forecastContent');

        if (!this.state.forecast || !card || !content) return;

        const forecast = this.state.forecast;
        card.style.display = 'block';

        // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ –¥–Ω—è–º
        const dailyForecast = forecast.list.filter((item, index) => index % 8 === 0).slice(0, 5);

        content.innerHTML = dailyForecast.map(item => `
            <div class="forecast-day">
                <div class="forecast-date">${new Date(item.dt * 1000).toLocaleDateString('ru-RU', { 
                    weekday: 'short', 
                    month: 'short', 
                    day: 'numeric' 
                })}</div>
                <div class="forecast-temp">${Math.round(item.main.temp)}¬∞C</div>
                <div class="forecast-desc">${item.weather[0].description}</div>
                <div class="weather-details">
                    <small>üíß ${item.main.humidity}%</small>
                    <small>üí® ${item.wind.speed} –º/—Å</small>
                </div>
            </div>
        `).join('');
    }

    private updateLoadingDisplay(): void {
        const loadingIndicator = document.getElementById('loadingIndicator');
        if (loadingIndicator) {
            loadingIndicator.style.display = this.state.loading ? 'flex' : 'none';
        }
    }

    private updateHistoryDisplay(): void {
        const container = document.getElementById('historyContainer');
        if (!container) return;

        container.innerHTML = this.state.history.map(item => `
            <div class="history-item">
                <strong>${item.city}</strong> - ${item.temperature}¬∞C
                <br>
                <small>${item.description} ‚Ä¢ ${new Date(item.timestamp).toLocaleString('ru-RU')}</small>
            </div>
        `).join('') || '<p>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—É—Å—Ç–∞</p>';
    }

    private showError(message: string): void {
        // –ú–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
        console.error('Weather error:', message);
        alert(`–û—à–∏–±–∫–∞: ${message}`);
    }

    // –ü—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ API
    public async checkAPIStatus(): Promise<void> {
        const statusContainer = document.getElementById('apiStatus');
        if (!statusContainer) return;

        const isOnline = await this.api.checkAPIStatus();
        
        statusContainer.innerHTML = `
            <div class="status-item ${isOnline ? 'status-online' : 'status-offline'}">
                <h3>Weather API</h3>