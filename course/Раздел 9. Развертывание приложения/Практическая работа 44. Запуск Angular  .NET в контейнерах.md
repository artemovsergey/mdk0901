# Практическая работа. Запуск Angular и .NET приложений в Docker Compose

## Тема
Контейнеризация full-stack приложения с использованием Angular, .NET и Docker Compose

## Цель
Освоить практические навыки создания Docker-контейнеров для full-stack приложений, настройки Docker Compose для оркестрации многоконтейнерных приложений и управления жизненным циклом приложения в изолированной среде.

## Теоретическая часть

### Docker Compose
Docker Compose - инструмент для определения и запуска многоконтейнерных Docker приложений. С помощью YAML-файла можно настроить сервисы, сети и тома приложения.

### Основные концепции:
- **Services** - контейнеры, которые составляют приложение
- **Networks** - сетевые подключения между сервисами
- **Volumes** - постоянное хранение данных

### Преимущества Docker Compose:
- Изоляция окружения
- Простота развертывания
- Согласованность сред разработки
- Масштабируемость

## Практический пример

### Структура проекта
```
docker-compose-demo/
├── backend/
│   ├── Dockerfile
│   ├── WebAPI.csproj
│   └── Controllers/
├── frontend/
│   ├── Dockerfile
│   ├── package.json
│   └── src/
├── docker-compose.yml
└── README.md
```

### Backend (.NET Web API)

**backend/Controllers/ProductsController.cs**
```csharp
using Microsoft.AspNetCore.Mvc;

namespace WebAPI.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    public class ProductsController : ControllerBase
    {
        private static readonly List<Product> Products = new()
        {
            new Product { Id = 1, Name = "Laptop", Price = 999.99m },
            new Product { Id = 2, Name = "Mouse", Price = 25.50m },
            new Product { Id = 3, Name = "Keyboard", Price = 75.00m }
        };

        [HttpGet]
        public IActionResult GetProducts()
        {
            return Ok(Products);
        }

        [HttpGet("{id}")]
        public IActionResult GetProduct(int id)
        {
            var product = Products.FirstOrDefault(p => p.Id == id);
            return product != null ? Ok(product) : NotFound();
        }
    }

    public class Product
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public decimal Price { get; set; }
    }
}
```

**backend/Dockerfile**
```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY WebAPI.csproj .
RUN dotnet restore
COPY . .
RUN dotnet publish -c release -o /app

FROM mcr.microsoft.com/dotnet/aspnet:8.0
WORKDIR /app
COPY --from=build /app .
EXPOSE 80
ENTRYPOINT ["dotnet", "WebAPI.dll"]
```

### Frontend (Angular)

**frontend/src/app/app.component.ts**
```typescript
import { Component, OnInit } from '@angular/core';
import { HttpClient } from '@angular/common/http';

interface Product {
  id: number;
  name: string;
  price: number;
}

@Component({
  selector: 'app-root',
  template: `
    <div class="container">
      <h1>Products Store</h1>
      <div class="products-grid">
        <div *ngFor="let product of products" class="product-card">
          <h3>{{ product.name }}</h3>
          <p>Price: ${{ product.price }}</p>
          <p>ID: {{ product.id }}</p>
        </div>
      </div>
    </div>
  `,
  styles: [`
    .container { padding: 20px; }
    .products-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
      gap: 20px; 
      margin-top: 20px;
    }
    .product-card {
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 8px;
      background: #f9f9f9;
    }
  `]
})
export class AppComponent implements OnInit {
  products: Product[] = [];

  constructor(private http: HttpClient) {}

  ngOnInit() {
    this.http.get<Product[]>('http://localhost:5000/api/products')
      .subscribe(products => this.products = products);
  }
}
```

**frontend/Dockerfile**
```dockerfile
FROM node:18-alpine AS build
WORKDIR /app
COPY package.json package-lock.json ./
RUN npm install
COPY . .
RUN npm run build --prod

FROM nginx:alpine
COPY --from=build /app/dist/frontend /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80
```

### Docker Compose

**docker-compose.yml**
```yaml
version: '3.8'

services:
  backend:
    build: 
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "5000:80"
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
    networks:
      - app-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "4200:80"
    depends_on:
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
```

## Ход работы

1. **Подготовка окружения**
   - Установить Docker Desktop
   - Установить Git
   - Создать рабочую директорию

2. **Создание структуры проекта**
   - Создать папки backend и frontend
   - Настроить .NET Web API проект
   - Настроить Angular проект

3. **Создание Dockerfile для каждого сервиса**
   - Backend Dockerfile
   - Frontend Dockerfile

4. **Настройка Docker Compose**
   - Создать docker-compose.yml
   - Настроить сеть и зависимости

5. **Запуск приложения**
   - Выполнить `docker-compose up --build`
   - Проверить работу приложения

6. **Тестирование**
   - Проверить API endpoints
   - Проверить фронтенд приложение

## 15 вариантов заданий

### Вариант 1
Создать приложение "Список задач" с возможностью добавления, удаления и отметки выполненных задач.

### Вариант 2
Разработать приложение "Погодный виджет" с отображением текущей погоды и прогноза.

### Вариант 3
Создать "Книжную библиотеку" с возможностью добавления книг, поиска и фильтрации.

### Вариант 4
Разработать "Финансовый трекер" для учета доходов и расходов.

### Вариант 5
Создать приложение "Список контактов" с CRUD операциями.

### Вариант 6
Разработать "Блог платформу" с статьями и комментариями.

### Вариант 7
Создать "Инвентарную систему" для учета товаров.

### Вариант 8
Разработать "Систему голосования" с созданием опросов.

### Вариант 9
Создать "Календарь событий" с добавлением и управлением событиями.

### Вариант 10
Разработать "Ресторанное меню" с категориями и блюдами.

### Вариант 11
Создать "Спортивный трекер" для учета тренировок.

### Вариант 12
Разработать "Музыкальную библиотеку" с альбомами и песнями.

### Вариант 13
Создать "Систему бронирования" для отеля.

### Вариант 14
Разработать "Образовательный портал" с курсами и уроками.

### Вариант 15
Создать "Социальную сеть" с пользователями и постами.

## Критерии оценки

### 5 (Отлично)
- Все контейнеры успешно запускаются
- Приложение полностью функционально
- Код хорошо структурирован и документирован
- Dockerfile оптимизированы
- docker-compose.yml корректно настроен
- Представлены скриншоты работающего приложения

### 4 (Хорошо)
- Контейнеры запускаются с незначительными проблемами
- Основной функционал работает
- Код читаем и логичен
- Есть небольшие недочеты в настройке

### 3 (Удовлетворительно)
- Контейнеры запускаются с ошибками
- Часть функционала не работает
- Код требует доработки
- Отсутствует часть требуемой функциональности

### 2 (Неудовлетворительно)
- Контейнеры не запускаются
- Приложение не работает
- Критические ошибки в коде
- Не выполнены основные требования

## Контрольные вопросы

1. Что такое Docker Compose и для чего он используется?
2. Каковы преимущества контейнеризации приложений?
3. Как работает многостадийная сборка в Docker?
4. Что такое Dockerfile и какие инструкции он содержит?
5. Как организовать связь между контейнерами в Docker Compose?
6. Какие лучшие практики существуют для создания Docker образов?
7. Как управлять переменными окружения в Docker Compose?
8. Что такое тома (volumes) и для чего они используются?
9. Как настроить health checks для контейнеров?
10. Какие команды Docker Compose используются для управления приложением?

---

# Пример README.md для студента (Вариант 1)

```markdown
# Практическая работа №3
## Запуск Angular и .NET приложений в Docker Compose

**Вариант:** 1
**Студент:** [ФИО]
**Группа:** [Номер группы]

## Задание
Создать приложение "Список задач" с возможностью добавления, удаления и отметки выполненных задач с использованием Angular, .NET и Docker Compose.

## Структура проекта
```
project/
├── backend/
│   ├── Dockerfile
│   ├── Controllers/
│   └── Models/
├── frontend/
│   ├── Dockerfile
│   ├── src/
│   └── nginx.conf
├── docker-compose.yml
└── README.md
```

## Backend (.NET Web API)

**Controllers/TasksController.cs**
```csharp
[ApiController]
[Route("api/[controller]")]
public class TasksController : ControllerBase
{
    private static List<TaskItem> tasks = new();

    [HttpGet]
    public IActionResult GetTasks() => Ok(tasks);

    [HttpPost]
    public IActionResult AddTask(TaskItem task)
    {
        task.Id = tasks.Count + 1;
        tasks.Add(task);
        return CreatedAtAction(nameof(GetTasks), task);
    }

    [HttpPut("{id}")]
    public IActionResult ToggleTask(int id)
    {
        var task = tasks.FirstOrDefault(t => t.Id == id);
        if (task != null)
        {
            task.IsCompleted = !task.IsCompleted;
            return Ok(task);
        }
        return NotFound();
    }

    [HttpDelete("{id}")]
    public IActionResult DeleteTask(int id)
    {
        var task = tasks.FirstOrDefault(t => t.Id == id);
        if (task != null)
        {
            tasks.Remove(task);
            return NoContent();
        }
        return NotFound();
    }
}

public class TaskItem
{
    public int Id { get; set; }
    public string Title { get; set; } = string.Empty;
    public bool IsCompleted { get; set; }
}
```

**Dockerfile**
```dockerfile
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src
COPY *.csproj .
RUN dotnet restore
COPY . .
RUN dotnet publish -c release -o /app

FROM mcr.microsoft.com/dotnet/aspnet:8.0
WORKDIR /app
COPY --from=build /app .
EXPOSE 80
ENTRYPOINT ["dotnet", "WebAPI.dll"]
```

## Frontend (Angular)

**app.component.ts**
```typescript
@Component({
  template: `
    <div class="container">
      <h1>Task Manager</h1>
      <div class="add-task">
        <input [(ngModel)]="newTask" placeholder="New task">
        <button (click)="addTask()">Add</button>
      </div>
      <div class="tasks">
        <div *ngFor="let task of tasks" class="task-item">
          <span [class.completed]="task.isCompleted">{{ task.title }}</span>
          <div>
            <button (click)="toggleTask(task.id)">Toggle</button>
            <button (click)="deleteTask(task.id)">Delete</button>
          </div>
        </div>
      </div>
    </div>
  `
})
export class AppComponent {
  tasks: any[] = [];
  newTask = '';

  constructor(private http: HttpClient) {}

  ngOnInit() {
    this.loadTasks();
  }

  loadTasks() {
    this.http.get<any[]>('http://localhost:5000/api/tasks')
      .subscribe(tasks => this.tasks = tasks);
  }

  addTask() {
    if (this.newTask.trim()) {
      this.http.post('http://localhost:5000/api/tasks', 
        { title: this.newTask, isCompleted: false })
        .subscribe(() => {
          this.newTask = '';
          this.loadTasks();
        });
    }
  }

  toggleTask(id: number) {
    this.http.put(`http://localhost:5000/api/tasks/${id}`, {})
      .subscribe(() => this.loadTasks());
  }

  deleteTask(id: number) {
    this.http.delete(`http://localhost:5000/api/tasks/${id}`)
      .subscribe(() => this.loadTasks());
  }
}
```

## Docker Compose

**docker-compose.yml**
```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    ports:
      - "5000:80"
    networks:
      - app-network

  frontend:
    build: ./frontend
    ports:
      - "4200:80"
    depends_on:
      - backend
    networks:
      - app-network

networks:
  app-network:
    driver: bridge
```

## Запуск приложения

```bash
# Клонирование репозитория
git clone [repository-url]

# Запуск приложения
docker-compose up --build

# Остановка приложения
docker-compose down
```

## Скриншоты

### Работающее приложение
![Главная страница](images/main-page.png)

### Docker контейнеры
![Docker контейнеры](images/docker-containers.png)
```

## Развертывание на Gogs

1. Установите и настройте Gogs на локальном сервере
2. Создайте новый репозиторий
3. Инициализируйте локальный git репозиторий:
```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin http://localhost:3000/username/repository-name.git
git push -u origin main
```
