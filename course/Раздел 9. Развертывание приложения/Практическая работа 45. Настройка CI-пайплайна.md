# Практическая работа. Настройка CI/CD пайплайна в GitHub Actions для .NET приложения**

### **Тема**
Автоматизация процессов разработки: создание и настройка CI/CD пайплайна с использованием GitHub Actions для ASP.NET Core приложения.

### **Цель**
Научиться создавать автоматизированные пайплайны сборки, тестирования и развертывания .NET приложений с использованием GitHub Actions. Сформировать понимание принципов Continuous Integration и Continuous Deployment.

### **Теоретическая часть**

#### **CI/CD (Continuous Integration / Continuous Deployment)**
- **Continuous Integration** - практика автоматической сборки и тестирования кода при каждом коммите в репозиторий
- **Continuous Deployment** - автоматическое развертывание приложения после успешной сборки и тестирования

#### **GitHub Actions**
- Встроенная платформа для автоматизации workflows в GitHub
- **Workflow** - автоматизированный процесс, описанный в YAML-файле
- **Event** - событие, запускающее workflow (push, pull_request и др.)
- **Job** - набор шагов, выполняемых на одном раннере
- **Step** - отдельная задача в job (команда или action)

#### **Основные компоненты .NET пайплайна**
1. **Сборка проекта** - `dotnet build`
2. **Восстановление зависимостей** - `dotnet restore`
3. **Запуск тестов** - `dotnet test`
4. **Публикация артефактов** - `dotnet publish`
5. **Развертывание** - загрузка на сервер или в облако

### **Практический пример**

#### **Структура проекта**
```
MyWebApp/
├── MyWebApp/
│   ├── Controllers/
│   ├── Models/
│   ├── Program.cs
│   └── MyWebApp.csproj
├── MyWebApp.Tests/
│   └── MyWebApp.Tests.csproj
├── .github/
│   └── workflows/
│       └── dotnet.yml
├── images/
├── README.md
└── .gitignore
```

#### **Базовый workflow файл (.github/workflows/dotnet.yml)**
```yaml
name: .NET CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'

    - name: Restore dependencies
      run: dotnet restore

    - name: Build
      run: dotnet build --no-restore --configuration Release

    - name: Run tests
      run: dotnet test --no-build --verbosity normal
```

### **Ход работы**

1. **Подготовка проекта**
   - Создать ASP.NET Core Web API приложение
   - Добавить unit-тесты
   - Настроить структуру репозитория

2. **Настройка GitHub Actions**
   - Создать workflow файл
   - Настроить триггеры запуска
   - Добавить шаги сборки и тестирования

3. **Расширение пайплайна**
   - Добавить создание артефактов
   - Настроить уведомления
   - Добавить дополнительные проверки

4. **Тестирование и документирование**
   - Протестировать workflow
   - Сделать скриншоты
   - Заполнить README.md

### **15 вариантов заданий**

**Вариант 1:** Создать CI пайплайн для консольного приложения с запуском тестов и проверкой покрытия кода

**Вариант 2:** Настроить автоматическую сборку Docker-образа для ASP.NET Core приложения

**Вариант 3:** Реализовать пайплайн с разными конфигурациями сборки (Debug/Release)

**Вариант 4:** Настроить автоматическое создание релиза и публикацию артефактов

**Вариант 5:** Создать пайплайн с кэшированием зависимостей NuGet для ускорения сборки

**Вариант 6:** Реализовать проверку качества кода с помощью SonarCloud

**Вариант 7:** Настроить пайплайн с параллельным выполнением тестов разных типов

**Вариант 8:** Создать workflow с ручным подтверждением для развертывания в production

**Вариант 9:** Реализовать пайплайн с матрицей сборки для разных версий .NET

**Вариант 10:** Настроить автоматическое развертывание в Azure Web App

**Вариант 11:** Создать пайплайн с проверкой уязвимостей зависимостей

**Вариант 12:** Реализовать автоматическое создание документации с DocFX

**Вариант 13:** Настроить пайплайн с отправкой уведомлений в Telegram/Slack

**Вариант 14:** Создать workflow с кастомными условиями запуска для разных веток

**Вариант 15:** Реализовать пайплайн с интеграционными тестами в отдельном job

---

### **Пример выполнения для варианта 1**

#### **Создание README.md**

```markdown
# Практическая работа №5: Настройка CI/CD пайплайна в GitHub Actions

**Номер варианта:** 1

**Задание:** Создать CI пайплайн для консольного приложения с запуском тестов и проверкой покрытия кода

## Описание проекта
Консольное приложение для работы с математическими операциями и модуль тестов с проверкой покрытия кода.

## Структура пайплайна

```yaml
name: .NET Console App CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '8.0.x'
        
    - name: Restore dependencies
      run: dotnet restore
      
    - name: Build
      run: dotnet build --no-restore --configuration Release
      
    - name: Run tests with coverage
      run: |
        dotnet test --collect:"XPlat Code Coverage" --results-directory ./coverage
      
    - name: Upload coverage reports
      uses: actions/upload-artifact@v4
      with:
        name: coverage-report
        path: coverage
```

## Результаты выполнения

### Скриншот успешного выполнения пайплайна:
![Successful Pipeline](images/pipeline-success.png)

### Скриншот отчета о покрытии кода:
![Coverage Report](images/coverage-report.png)

## Запуск проекта локально
```bash
dotnet restore
dotnet build
dotnet test
```
```

#### **Структура проекта для варианта 1**

```csharp
// Program.cs
using MathOperations;

Console.WriteLine("Math Operations Console App");

var calculator = new Calculator();
Console.WriteLine($"5 + 3 = {calculator.Add(5, 3)}");
Console.WriteLine($"10 - 4 = {calculator.Subtract(10, 4)}");
```

```csharp
// Calculator.cs
namespace MathOperations;

public class Calculator
{
    public int Add(int a, int b) => a + b;
    public int Subtract(int a, int b) => a - b;
    public int Multiply(int a, int b) => a * b;
    public double Divide(int a, int b) => b != 0 ? (double)a / b : throw new DivideByZeroException();
}
```

```csharp
// CalculatorTests.cs
using MathOperations;

namespace MathOperations.Tests;

public class CalculatorTests
{
    private readonly Calculator _calculator;

    public CalculatorTests()
    {
        _calculator = new Calculator();
    }

    [Fact]
    public void Add_TwoNumbers_ReturnsSum()
    {
        // Arrange
        int a = 5, b = 3;
        
        // Act
        var result = _calculator.Add(a, b);
        
        // Assert
        Assert.Equal(8, result);
    }

    [Theory]
    [InlineData(10, 4, 6)]
    [InlineData(0, 0, 0)]
    [InlineData(-5, -3, -2)]
    public void Subtract_TwoNumbers_ReturnsDifference(int a, int b, int expected)
    {
        // Act
        var result = _calculator.Subtract(a, b);
        
        // Assert
        Assert.Equal(expected, result);
    }
}
```

### **Критерии оценки**

**5 (Отлично)**
- Полностью работоспособный пайплайн
- Все шаги выполняются без ошибок
- Добавлены дополнительные улучшения (кэширование, артефакты)
- Качественное оформление README.md со скриншотами
- Проект выложен на Gogs

**4 (Хорошо)**
- Пайплайн работает корректно
- Основные шаги реализованы
- Есть небольшие недочеты в оформлении
- README.md содержит необходимую информацию

**3 (Удовлетворительно)**
- Пайплайн работает с ошибками в некоторых шагах
- Не все требования задания выполнены
- Отсутствуют некоторые скриншоты или документация

**2 (Неудовлетворительно)**
- Пайплайн не работает
- Критические ошибки в реализации
- Отсутствует большая часть требуемых элементов

### **Контрольные вопросы**

1. Что такое CI/CD и какие преимущества дает его использование?
2. Какие основные события (events) могут запускать workflow в GitHub Actions?
3. Как организовать кэширование зависимостей в .NET пайплайне?
4. Какие инструменты для анализа покрытия кода можно использовать в .NET?
5. Как настроить разные конфигурации для разных веток в одном workflow?
6. Что такое матрица сборки и для чего она используется?
7. Как организовать развертывание только после успешного прохождения тестов?
8. Какие способы хранения секретов существуют в GitHub Actions?
9. Как настроить уведомления о неудачных сборках?
10. В чем разница между Continuous Deployment и Continuous Delivery?

### **Инструкция для студентов**

1. Выберите вариант согласно номеру в журнале
2. Создайте локальный репозиторий с проектом .NET приложения
3. Реализуйте требуемый пайплайн в папке `.github/workflows/`
4. Протестируйте работу пайплайна, сделайте скриншоты
5. Заполните README.md по шаблону
6. Выложите проект на Gogs сервер
7. Предоставьте ссылку на репозиторий для проверки

### **Дополнительные рекомендации**

- Используйте meaningful names для jobs и steps
- Добавляйте условия выполнения для отдельных шагов (`if`)
- Используйте environment variables для конфигурации
- Тестируйте пайплайн на feature-ветках перед мержем в main
- Следите за временем выполнения и оптимизируйте при необходимости
