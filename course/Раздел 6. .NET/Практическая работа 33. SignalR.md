# Практическая работа. Real-time приложения с SignalR

## Тема
"Создание real-time веб-приложений с использованием ASP.NET Core SignalR"

## Цель
Освоить принципы работы с SignalR для создания real-time приложений, изучить основные концепции хуков, клиент-серверного взаимодействия и реализовать простое чат-приложение.

## Теоретическая часть

### Что такое SignalR?
SignalR - библиотека для ASP.NET, которая упрощает добавление функциональности real-time веб-приложений. Она использует различные транспорты (WebSocket, Server-Sent Events, Long Polling) автоматически выбирая лучший из доступных.

### Основные компоненты:
- **Хаб (Hub)** - основной компонент для клиент-серверного взаимодействия
- **Группы** - механизм для группировки клиентов
- **Клиенты** - подключенные приложения (веб, мобильные, десктоп)

### Методы взаимодействия:
- `Clients.All` - отправка всем клиентам
- `Clients.Caller` - отправка только вызвавшему клиенту
- `Clients.Others` - отправка всем кроме вызвавшего

## Практический пример: Простой чат

### Серверная часть (Hub)

```csharp
using Microsoft.AspNetCore.SignalR;

public class ChatHub : Hub
{
    public async Task SendMessage(string user, string message)
    {
        await Clients.All.SendAsync("ReceiveMessage", user, message);
    }

    public override async Task OnConnectedAsync()
    {
        await Clients.All.SendAsync("UserConnected", Context.ConnectionId);
        await base.OnConnectedAsync();
    }

    public override async Task OnDisconnectedAsync(Exception exception)
    {
        await Clients.All.SendAsync("UserDisconnected", Context.ConnectionId);
        await base.OnDisconnectedAsync(exception);
    }
}
```

### Клиентская часть (JavaScript)

```javascript
const connection = new signalR.HubConnectionBuilder()
    .withUrl("/chatHub")
    .build();

connection.on("ReceiveMessage", (user, message) => {
    const msg = `${user}: ${message}`;
    const li = document.createElement("li");
    li.textContent = msg;
    document.getElementById("messagesList").appendChild(li);
});

connection.start().catch(err => console.error(err.toString()));

document.getElementById("sendButton").addEventListener("click", async () => {
    const user = document.getElementById("userInput").value;
    const message = document.getElementById("messageInput").value;
    await connection.invoke("SendMessage", user, message);
});
```

## Ход работы

1. Создать новый ASP.NET Core Web Application
2. Добавить SignalR сервисы в Program.cs
3. Создать класс ChatHub
4. Настроить маршрутизацию для хаба
5. Создать клиентскую страницу с HTML и JavaScript
6. Протестировать приложение

## 15 вариантов заданий

### Вариант 1: Базовый чат
Создать простой чат с возможностью отправки сообщений всем пользователям.

### Вариант 2: Приватные сообщения
Реализовать отправку приватных сообщений конкретным пользователям по ConnectionId.

### Вариант 3: Комнаты чата
Создать систему комнат чата с возможностью присоединения/покидания комнат.

### Вариант 4: Уведомления
Реализовать систему уведомлений для всех подключенных пользователей.

### Вариант 5: Онлайн-рисовалка
Создать простую рисовалку, где все пользователи видят изменения в реальном времени.

### Вариант 6: Счетчик онлайн пользователей
Реализовать отображение количества онлайн пользователей в реальном времени.

### Вариант 7: Совместный редактор текста
Создать простой текстовый редактор с синхронизацией между пользователями.

### Вариант 8: Игра "Крестики-нолики"
Реализовать многопользовательскую игру в крестики-нолики.

### Вариант 9: Система голосования
Создать систему голосования с обновлением результатов в реальном времени.

### Вариант 10: Доска объявлений
Реализовать доску объявлений с мгновенным обновлением для всех пользователей.

### Вариант 11: Таймер обратного отсчета
Создать синхронизированный таймер обратного отсчета для всех пользователей.

### Вариант 12: Система комментариев
Реализовать систему комментариев с мгновенным отображением новых комментариев.

### Вариант 13: Совместный список задач
Создать общий список задач с возможностью добавления/удаления задач всеми пользователями.

### Вариант 14: Аукцион
Реализовать систему онлайн-аукциона с обновлением ставок в реальном времени.

### Вариант 15: Погодная станция
Создать систему отображения данных с "погодной станции" с обновлением каждые 5 секунд.

## Критерии оценки

**5 (Отлично):**
- Полностью рабочее приложение
- Реализованы все требования варианта
- Чистый и хорошо структурированный код
- Корректная обработка ошибок
- Красивый и удобный интерфейс

**4 (Хорошо):**
- Приложение работает с незначительными недочетами
- Реализованы основные требования
- Код в основном чистый и понятный
- Есть базовая обработка ошибок

**3 (Удовлетворительно):**
- Приложение работает с ограниченной функциональностью
- Реализованы только базовые требования
- Код требует улучшения структуры
- Отсутствует обработка ошибок

**2 (Неудовлетворительно):**
- Приложение не работает или работает некорректно
- Требования не выполнены
- Код нечитаемый и неструктурированный

## Контрольные вопросы

1. Что такое SignalR и для чего он используется?
2. Какие транспорты поддерживает SignalR?
3. Что такое хаб в контексте SignalR?
4. Как организовать отправку сообщений конкретному клиенту?
5. Что такое группы в SignalR и как с ними работать?
6. Как обрабатывать события подключения и отключения клиентов?
7. Какие методы безопасности следует учитывать при работе с SignalR?
8. Как настроить CORS для SignalR?
9. В чем разница между `Clients.All` и `Clients.Others`?
10. Как обрабатывать ошибки на клиентской стороне?

---

# Пример README.md для варианта 1

```markdown
# Практическая работа №X: Real-time приложения с SignalR

**Вариант:** 1  
**Студент:** Иванов И.И.  
**Группа:** ПИ-21-1

## Задание
Создать простой чат с возможностью отправки сообщений всем пользователям.

## Реализация

### Серверная часть (ChatHub.cs)

```csharp
using Microsoft.AspNetCore.SignalR;

public class ChatHub : Hub
{
    public async Task SendMessage(string user, string message)
    {
        await Clients.All.SendAsync("ReceiveMessage", user, message, DateTime.Now.ToString("HH:mm"));
    }

    public override async Task OnConnectedAsync()
    {
        await Clients.All.SendAsync("SystemMessage", $"Пользователь {Context.ConnectionId} подключился");
        await base.OnConnectedAsync();
    }

    public override async Task OnDisconnectedAsync(Exception exception)
    {
        await Clients.All.SendAsync("SystemMessage", $"Пользователь {Context.ConnectionId} отключился");
        await base.OnDisconnectedAsync(exception);
    }
}
```

### Клиентская часть (JavaScript)

```javascript
const connection = new signalR.HubConnectionBuilder()
    .withUrl("/chatHub")
    .build();

connection.on("ReceiveMessage", (user, message, time) => {
    const msg = `[${time}] ${user}: ${message}`;
    addMessageToChat(msg);
});

connection.on("SystemMessage", (message) => {
    addMessageToChat(`[Система] ${message}`);
});

function addMessageToChat(message) {
    const li = document.createElement("li");
    li.textContent = message;
    document.getElementById("messagesList").appendChild(li);
}

document.getElementById("sendButton").addEventListener("click", async () => {
    const user = document.getElementById("userInput").value || "Аноним";
    const message = document.getElementById("messageInput").value;
    
    if (message) {
        await connection.invoke("SendMessage", user, message);
        document.getElementById("messageInput").value = "";
    }
});

connection.start().catch(err => console.error(err.toString()));
```

## Скриншоты работы программы

![Главная страница чата](images/chat-main.png)
*Главная страница чат-приложения*

![Обмен сообщениями](images/chat-messages.png)
*Пример обмена сообщениями между пользователями*

## Запуск приложения

1. Клонировать репозиторий
2. Открыть решение в Visual Studio
3. Запустить приложение
4. Открыть несколько вкладок браузера для тестирования
```

## Структура репозитория

```
SignalR-Practical-Work/
│
├── ChatApp/                          # Проект решения
│   ├── Hubs/
│   │   └── ChatHub.cs
│   ├── Program.cs
│   ├── appsettings.json
│   └── wwwroot/
│       ├── index.html
│       └── css/
│           └── site.css
│
├── images/                           # Скриншоты работы
│   ├── chat-main.png
│   └── chat-messages.png
│
└── README.md                         # Документация
```

Для развертывания на Gogs:
1. Создать новый репозиторий на локальном Gogs сервере
2. Клонировать репозиторий локально
3. Добавить файлы проекта
4. Сделать коммит и пуш изменений