# Лекция. Основы программирования на .NET: Типы данных, поток выполнения и структуры данных

**Цель:** Дать фундаментальное понимание основных строительных блоков программ на C# и .NET, включая систему типов, управление логикой выполнения и часто используемые структуры данных.

---

### **План лекции:**

1.  **Введение в систему типов .NET**
    *   Что такое тип данных?
    *   Common Type System (CTS)
    *   Значимые типы (Value Types) и Ссылочные типы (Reference Types)
    *   Ключевые слова C# и типы .NET Framework (псевдонимы)

2.  **Управление потоком выполнения**
    *   Условные конструкции: `if-else`, `switch`
    *   Циклы: `for`, `while`, `do-while`, `foreach`
    *   Ключевые слова для управления циклом: `break`, `continue`

3.  **Структуры данных в .NET**
    *   Понятие коллекции.
    *   Классы `Array`, `List<T>`, `Dictionary<TKey, TValue>`
    *   Стек, очередь и хеш-множество: `Stack<T>`, `Queue<T>`, `HashSet<T>`

4.  **Резюме**
5.  **Контрольные вопросы**

---

### **Детальное рассмотрение пунктов плана:**

#### **1. Введение в систему типов .NET**

**Что такое тип данных?**
Тип данных определяет:
*   **Размер** выделяемой памяти.
*   **Диапазон возможных значений** (например, от -128 до 127 для `sbyte`).
*   **Набор допустимых операций** (например, с числами можно производить арифметические операции, а со строками — конкатенацию).

**Common Type System (CTS)**
CTS — это фундаментальная часть .NET, которая обеспечивает единую систему типов для всех языков, работающих на платформе. Это значит, что тип `int` в C# и `Integer` в VB.NET будут представлены одним и тем же типом в среде выполнения — `System.Int32`.

**Значимые типы (Value Types) и Ссылочные типы (Reference Types)**

Это **крайне важное** различие.

*   **Значимые типы (Value Types):**
    *   Хранят **непосредственно свои данные**.
    *   Размещаются в области памяти **стек** (быстрый доступ).
    *   При присваивании происходит **копирование значения**.
    *   К ним относятся:
        *   Встроенные простые типы: `int`, `float`, `bool`, `char`, `double`.
        *   Пользовательские структуры (`struct`).
        *   Перечисления (`enum`).

    **Пример:**
    ```csharp
    int a = 10;
    int b = a; // Копируется значение 10. Теперь 'a' и 'b' - два независимых числа.
    b = 20;    // Изменяем только 'b'
    Console.WriteLine(a); // Вывод: 10 (значение 'a' не изменилось)
    ```

*   **Ссылочные типы (Reference Types):**
    *   Хранят **ссылку (адрес в памяти)** на свои данные.
    *   Данные размещаются в **куче (heap)**.
    *   При присваивании происходит **копирование ссылки**, а не данных. Обе переменные начинают указывать на один и тот же объект в памяти.
    *   К ним относятся:
        *   Классы (`class`).
        *   Массивы (`Array`).
        *   Строка (`string` — важное исключение, так как она неизменяема).
        *   Интерфейсы (`interface`).
        *   Делегаты (`delegate`).

    **Пример:**
    ```csharp
    int[] array1 = new int[] { 1, 2, 3 };
    int[] array2 = array1; // Копируется ссылка. Оба массива указывают на одни данные.
    array2[0] = 100;      // Меняем данные по ссылке в array2
    Console.WriteLine(array1[0]); // Вывод: 100 (изменение видно и через array1!)
    ```

**Ключевые слова C# и типы .NET Framework**
C# предоставляет удобные ключевые слова, которые являются псевдонимами для типов из пространства имен .NET.

| Ключевое слово C# | Тип .NET (FCL) | Описание                          |
| ----------------- | -------------- | --------------------------------- |
| `int`             | `System.Int32` | 32-битное целое число со знаком   |
| `float`           | `System.Single` | 32-битное число с плавающей точкой |
| `bool`            | `System.Boolean` | Логическое значение (true/false)  |
| `string`          | `System.String` | Неизменяемая последовательность символов Unicode |

---

#### **2. Управление потоком выполнения**

Это конструкции, которые позволяют контролировать порядок выполнения инструкций в программе.

**Условные конструкции:**

*   **`if-else`**: Проверяет логическое условие.
    ```csharp
    int number = 10;
    if (number > 0)
    {
        Console.WriteLine("Число положительное.");
    }
    else if (number < 0)
    {
        Console.WriteLine("Число отрицательное.");
    }
    else
    {
        Console.WriteLine("Число равно нулю.");
    }
    ```

*   **`switch`**: Полезен для множественного выбора на основе одного значения.
    ```csharp
    string day = "Пн";
    switch (day)
    {
        case "Пн":
            Console.WriteLine("Понедельник - день тяжелый.");
            break;
        case "Сб":
        case "Вс":
            Console.WriteLine("Ура, выходные!");
            break;
        default:
            Console.WriteLine("Обычный рабочий день.");
            break;
    }
    ```

**Циклы:**

*   **`for`**: Используется, когда известно количество итераций.
    ```csharp
    // Вывод чисел от 0 до 4
    for (int i = 0; i < 5; i++)
    {
        Console.WriteLine(i);
    }
    ```

*   **`while`**: Выполняется, пока условие истинно. Проверяет условие **до** выполнения тела цикла.
    ```csharp
    int count = 0;
    while (count < 5)
    {
        Console.WriteLine(count);
        count++;
    }
    ```

*   **`do-while`**: Выполняется, пока условие истинно. Проверяет условие **после** выполнения тела цикла (тело выполнится хотя бы один раз).
    ```csharp
    int userInput;
    do
    {
        Console.WriteLine("Введите число 5:");
        userInput = Convert.ToInt32(Console.ReadLine());
    } while (userInput != 5);
    ```

*   **`foreach`**: Идеален для перебора всех элементов в коллекции (массиве, списке и т.д.).
    ```csharp
    string[] colors = { "red", "green", "blue" };
    foreach (string color in colors)
    {
        Console.WriteLine(color); // Выведет: red, затем green, затем blue
    }
    ```

**Ключевые слова управления циклом:**

*   **`break`**: Немедленно завершает выполнение цикла.
*   **`continue`**: Немедленно переходит к следующей итерации цикла, пропуская оставшийся код в теле текущей итерации.

---

#### **3. Структуры данных в .NET**

Структуры данных — это контейнеры, которые организуют и хранят данные эффективным для доступа и модификации способом.

**Понятие коллекции.** Коллекции в .NET — это классы, реализующие различные структуры данных. Они находятся в пространствах имен `System.Collections` и `System.Collections.Generic`. Мы будем рассматривать **обобщенные (generic)** коллекции (`System.Collections.Generic`), так как они типобезопасны и эффективнее.

**`Array` (Массив)**
*   Простейшая структура. Фиксированный размер после создания.
*   Быстрый доступ по индексу.
*   **Пример:**
    ```csharp
    int[] fixedSizeArray = new int[3] { 1, 2, 3 };
    // fixedSizeArray[3] = 4; // Ошибка! Индекс вне границ массива.
    ```

**`List<T>` (Список)**
*   **Динамический массив**. Размер автоматически увеличивается при добавлении элементов.
*   Наиболее часто используемая коллекция.
*   **Пример:**
    ```csharp
    List<string> fruits = new List<string>();
    fruits.Add("Apple"); // Добавление элемента
    fruits.Add("Banana");
    fruits.Insert(1, "Orange"); // Вставка по индексу 1
    fruits.Remove("Apple"); // Удаление элемента

    foreach (string fruit in fruits)
    {
        Console.WriteLine(fruit); // Вывод: Orange, Banana
    }
    Console.WriteLine($"Всего фруктов: {fruits.Count}"); // Вывод: 2
    ```

**`Dictionary<TKey, TValue>` (Словарь)**
*   Коллекция пар "ключ-значение". Обеспечивает очень быстрый поиск по ключу.
*   Ключи должны быть уникальными.
*   **Пример (База данных сотрудников):**
    ```csharp
    Dictionary<int, string> employees = new Dictionary<int, string>();
    employees.Add(101, "Иван Иванов");
    employees.Add(102, "Петр Петров");
    employees.Add(103, "Мария Сидорова");

    // Быстрый поиск сотрудника по табельному номеру (ключу)
    int idToFind = 102;
    if (employees.ContainsKey(idToFind))
    {
        Console.WriteLine($"Сотрудник с id {idToFind}: {employees[idToFind]}");
    }

    // Перебор всех пар в словаре
    foreach (var employee in employees)
    {
        Console.WriteLine($"ID: {employee.Key}, Имя: {employee.Value}");
    }
    ```

**`Stack<T>` (Стек)**
*   Коллекция, работающая по принципу **LIFO** (Last-In-First-Out) — "последним пришел, первым ушел".
*   Основные методы: `Push` (добавить элемент), `Pop` (извлечь и удалить верхний элемент), `Peek` (посмотреть верхний элемент без удаления).
*   **Пример (История действий):**
    ```csharp
    Stack<string> browserHistory = new Stack<string>();
    browserHistory.Push("google.com");
    browserHistory.Push("microsoft.com");
    browserHistory.Push("learn.microsoft.com");

    // Нажатие кнопки "Назад"
    string previousPage = browserHistory.Pop(); // Извлекает "learn.microsoft.com"
    Console.WriteLine($"Переход назад на: {previousPage}");
    Console.WriteLine($"Текущая страница: {browserHistory.Peek()}"); // "microsoft.com"
    ```

**`Queue<T>` (Очередь)**
*   Коллекция, работающая по принципу **FIFO** (First-In-First-Out) — "первым пришел, первым ушел".
*   Основные методы: `Enqueue` (добавить в конец), `Dequeue` (извлечь и удалить первый элемент), `Peek` (посмотреть первый элемент).
*   **Пример (Задачи на печать):**
    ```csharp
    Queue<string> printQueue = new Queue<string>();
    printQueue.Enqueue("Document1.pdf");
    printQueue.Enqueue("Document2.docx");
    printQueue.Enqueue("Image.png");

    // Печать документов в порядке поступления
    while (printQueue.Count > 0)
    {
        string document = printQueue.Dequeue();
        Console.WriteLine($"Печатается: {document}");
    }
    ```

**`HashSet<T>` (Множество)**
*   Коллекция, хранящая **только уникальные** элементы.
*   Обеспечивает очень быстрые операции проверки принадлежности (`Contains`).
*   **Пример (Уникальные теги):**
    ```csharp
    HashSet<string> tags = new HashSet<string>();
    tags.Add("C#");
    tags.Add(".NET");
    tags.Add("Programming");
    tags.Add("C#"); // Этот элемент добавлен не будет, так как он уже есть

    Console.WriteLine($"Всего уникальных тегов: {tags.Count}"); // Вывод: 3
    Console.WriteLine(tags.Contains("Java")); // Вывод: False
    ```

---

### **4. Резюме**

*   **Типы данных** в .NET делятся на **значимые** (хранятся в стеке, копируются) и **ссылочные** (хранятся в куче, копируется ссылка). Понимание этой разницы критически важно для избежания ошибок.
*   **Управление потоком** (`if`, `switch`, циклы) позволяет реализовывать сложную логику в программах.
*   **Структуры данных** (`List`, `Dictionary`, `Stack`, `Queue`, `HashSet`) — это мощные инструменты для эффективной работы с наборами данных. Выбор правильной структуры данных напрямую влияет на производительность и читаемость кода.
    *   Нужен простой, динамический список? -> `List<T>`
    *   Нужен быстрый поиск по уникальному ключу? -> `Dictionary<TKey, TValue>`
    *   Обрабатываешь элементы в порядке LIFO? -> `Stack<T>`
    *   Обрабатываешь элементы в порядке FIFO? -> `Queue<T>`
    *   Нужно хранить только уникальные элементы? -> `HashSet<T>`

---

### **5. Контрольные вопросы**

1.  В чем основное различие между значимыми и ссылочными типами? Что произойдет в памяти при выполнении операции присваивания для переменной каждого типа?
2.  Объясните, в каких ситуациях вы бы использовали цикл `for`, а в каких — цикл `while`. Приведите примеры.
3.  В чем преимущество использования обобщенной коллекции `List<T>` по сравнению с обычным массивом `Array`?
4.  Представьте, что вы разрабатываете систему обработки заказов. Какую коллекцию вы бы использовали для хранения заказов в порядке их поступления и почему? (`Queue<T>`)
5.  Чем `Dictionary<TKey, TValue>` принципиально отличается от `List<T>`? Что является обязательным требованием к ключу в словаре?
6.  Каков будет результат выполнения следующего кода? Почему?
    ```csharp
    List<int> numbers = new List<int>() { 1, 2, 3 };
    List<int> numbersCopy = numbers;
    numbersCopy[0] = 100;
    Console.WriteLine(numbers[0]);
    ```
7.  В чем разница между методами `Pop()` и `Peek()` у коллекции `Stack<T>`?