# Лекция. Введение в ASP.NET Core: Структура проекта и контроллеры

**Цель:** Понять стандартную структуру проекта ASP.NET Core и научиться создавать базовые контроллеры для обработки HTTP-запросов.

---

### **Тема**
Основы построения веб-приложений с использованием ASP.NET Core. Изучение структуры проекта по умолчанию и создание контроллеров — фундаментальных строительных блоков для обработки запросов и возврата responses.

---

### **План лекции**

1.  **Введение в ASP.NET Core**
    *   Что такое ASP.NET Core?
    *   Паттерн MVC (Model-View-Controller).
2.  **Структура проекта ASP.NET Core**
    *   Обзор проекта, созданного из шаблона "Web App (Model-View-Controller)".
    *   Подробный разбор ключевых файлов и папок:
        *   `Program.cs` — точка входа и конфигурация.
        *   `Startup.cs` (для .NET 5 и ранее) или только `Program.cs` (для .NET 6+).
        *   Папки `Controllers`, `Models`, `Views`.
        *   `wwwroot` — статические файлы.
        *   `appsettings.json` — конфигурация.
3.  **Контроллеры: Сердце приложения**
    *   Что такое контроллер и зачем он нужен?
    *   Соглашения по именованию и структуре.
    *   Создание своего первого контроллера.
4.  **Методы действий (Action Methods)**
    *   Что такое метод действия?
    *   Соответствие HTTP-методов (GET, POST) и методов контроллера.
    *   Возвращаемые типы: `IActionResult`, `ViewResult`, `JsonResult` и др.
    *   Параметры в методах действий.
5.  **Маршрутизация (Routing)**
    *   Конвенционная маршрутизация (по умолчанию).
    *   Атрибутная маршрутизация.

---

### **Подробное содержание лекции по пунктам плана**

#### **1. Введение в ASP.NET Core**

**Что такое ASP.NET Core?**
ASP.NET Core — это кроссплатформенный, высокопроизводительный фреймворк с открытым исходным кодом для построения современных облачных веб-приложений. Это переработанная и оптимизированная версия классического ASP.NET.

*   **Кроссплатформенность:** Запускается на Windows, Linux и macOS.
*   **Высокая производительность:** Один из самых быстрых веб-фреймворков согласно тестам TechEmpower.
*   **Модульность:** Используется внедрение зависимостей "из коробки".

**Паттерн MVC (Model-View-Controller)**
Это архитектурный паттерн, который разделяет приложение на три основные компонента:
*   **Model (Модель):** Представляет данные и бизнес-логику. Отвечает на запросы View и на инструкции от Controller для обновления себя.
*   **View (Представление):** Отвечает за отображение данных пользователю (например, HTML-страница).
*   **Controller (Контроллер):** Обрабатывает входящие HTTP-запросы. Получает данные от Model и передает их в View для отображения. Это "дирижер" нашего приложения.

**Взаимодействие:** Пользователь -> Запрос -> **Controller** -> Работа с **Model** -> Выбор **View** -> Ответ пользователю.

---

#### **2. Структура проекта ASP.NET Core**

Давайте рассмотрим проект, созданный из шаблона "ASP.NET Core Web App (Model-View-Controller)".

**Ключевые элементы:**

*   **`Program.cs` (Точка входа, .NET 6+)**
    Это стартовая точка приложения. Здесь настраивается хост и сервисы приложения.

    **Пример (из шаблона):**
    ```csharp
    var builder = WebApplication.CreateBuilder(args);

    // Добавление сервисов в контейнер (Dependency Injection).
    builder.Services.AddControllersWithViews(); // Регистрирует службы, необходимые для MVC.

    var app = builder.Build();

    // Конфигурация конвейера обработки HTTP-запросов (Middleware).
    if (!app.Environment.IsDevelopment())
    {
        app.UseExceptionHandler("/Home/Error");
        app.UseHsts();
    }

    app.UseHttpsRedirection();
    app.UseStaticFiles(); // Позволяет обслуживать статические файлы (css, js, картинки) из wwwroot.
    app.UseRouting();
    app.UseAuthorization();

    // Настройка маршрутов по умолчанию.
    app.MapControllerRoute(
        name: "default",
        pattern: "{controller=Home}/{action=Index}/{id?}"); 
        // Пример: /Product/Details/5 -> Controller: ProductController, Action: Details, параметр id=5.

    app.Run();
    ```

*   **Папка `Controllers`**
    Содержит классы контроллеров. По соглашению, имена контроллеров оканчиваются на `Controller` (например, `HomeController`, `ProductController`).

*   **Папка `Models`**
    Содержит классы, которые представляют данные вашего приложения (например, `User.cs`, `Order.cs`).

*   **Папка `Views`**
    Содержит Razor-представления (`.cshtml` файлы), которые отвечают за генерацию HTML. Внутри обычно есть папки, названные в честь контроллеров (например, `/Views/Home/Index.cshtml`), и общий файл макета `_Layout.cshtml`.

*   **Папка `wwwroot`**
    Корневая папка для статических файлов: CSS, JavaScript, изображения, библиотеки. Все, что здесь лежит, доступно напрямую по относительному URL (например, `https://мойсайт/css/site.css` соответствует файлу `wwwroot/css/site.css`).

*   **`appsettings.json`**
    Файл конфигурации приложения. Здесь хранятся строки подключения к БД, логирование и другие настройки.

---

#### **3. Контроллеры: Сердце приложения**

**Что такое контроллер?**
Это обычный класс C#, который:
1.  Наследуется от класса `Controller` (рекомендуется) или `ControllerBase` (для API).
2.  Следует соглашению об именах: `[Имя]Controller`.
3.  Содержит публичные методы, называемые **методами действий (Action Methods)**.

**Зачем он нужен?**
Для обработки входящих HTTP-запросов и возврата ответа (HTML, JSON, файл и т.д.).

**Создание первого контроллера**

1.  Щелкните правой кнопкой на папку `Controllers` -> `Add` -> `Controller` -> `MVC Controller - Empty`.
2.  Назовите его `BookController`.

**Пример простейшего контроллера:**
```csharp
using Microsoft.AspNetCore.Mvc;

namespace MyWebApp.Controllers
{
    public class BookController : Controller // Наследование от Controller
    {
        // Это метод действия.
        public string Index()
        {
            return "Это простая строковая ответная страница для Index.";
        }

        public string Details(int id) // Параметр 'id' будет извлечен из URL
        {
            return $"Детали книги с ID: {id}";
        }
    }
}
```
*   **URL:** `/Book` -> вызовет `Index()`. (По умолчанию `Index` является действием по умолчанию).
*   **URL:** `/Book/Details/5` -> вызовет `Details(5)`.

---

#### **4. Методы действий (Action Methods)**

**Что такое метод действия?**
Это публичный метод в контроллере, который вызывается в ответ на HTTP-запрос. Не все публичные методы являются действиями (можно пометить метод как `[NonAction]`).

**Соответствие HTTP-методов:**
*   По умолчанию метод действия отвечает на запросы `GET`.
*   Чтобы указать конкретный HTTP-метод, используются **атрибуты**:
    *   `[HttpGet]`
    *   `[HttpPost]`
    *   `[HttpPut]`
    *   `[HttpDelete]` и др.

**Возвращаемые типы:**
Чаще всего используется `IActionResult` — это интерфейс, который позволяет возвращать различные типы ответов.

**Пример с разными возвращаемыми типами:**
```csharp
public class BookController : Controller
{
    // Возврат представления (HTML)
    public IActionResult Index()
    {
        return View(); // Ищет файл /Views/Book/Index.cshtml
    }

    // Возврат JSON данных (полезно для API)
    public IActionResult GetBookJson()
    {
        var book = new { Id = 1, Title = "CLR via C#", Author = "Джеффри Рихтер" };
        return Json(book);
    }

    // Возврат простого текста
    public IActionResult Welcome()
    {
        return Content("Добро пожаловать в книжный магазин!");
    }

    // Перенаправление на другой метод действия
    public IActionResult RedirectExample()
    {
        return RedirectToAction("Index", "Home"); // Перенаправляет на Home/Index
    }

    // Обработка POST-запроса
    [HttpPost] // Указывает, что этот метод обрабатывает только POST
    public IActionResult Create(Book book) // Модель будет привязана из данных формы
    {
        // ... логика сохранения книги ...
        return RedirectToAction("Index");
    }
}
```

**Параметры в методах действий:**
Платформа ASP.NET Core автоматически привязывает данные из различных частей запроса (URL, тело запроса, строка запроса) к параметрам метода.
```csharp
public IActionResult Search(string title, int? year) // 'year' - nullable
{
    // ... логика поиска ...
    // URL: /Book/Search?title=ASP.NET&year=2023
    return View();
}
```

---

#### **5. Маршрутизация (Routing)**

Это процесс определения того, какой контроллер и метод действия должен выполнить входящий запрос.

**А) Конвенционная маршрутизация (По умолчанию)**
Настраивается в `Program.cs` с помощью `MapControllerRoute`.
*   **Шаблон по умолчанию:** `{controller=Home}/{action=Index}/{id?}`
    *   `controller=Home`: Имя контроллера (суффикс `Controller` не указывается). `Home` — значение по умолчанию.
    *   `action=Index`: Имя метода действия. `Index` — значение по умолчанию.
    *   `id?`: Необязательный параметр. `?` означает, что параметр опционален.

    **Примеры соответствия:**
    *   `/` -> `HomeController.Index()`
    *   `/Book` -> `BookController.Index()`
    *   `/Book/Details` -> `BookController.Details()` (но ошибка, если `Details` требует параметр `id`)
    *   `/Book/Details/10` -> `BookController.Details(10)`

**Б) Атрибутная маршрутизация**
Более гибкий подход. Маршрут задается непосредственно над контроллером или методом с помощью атрибута `[Route]`.

**Пример на контроллере:**
```csharp
[Route("api/[controller]")] // [controller] заменяется на имя контроллера (Book)
[ApiController]
public class BookController : ControllerBase
{
    [HttpGet] // Соответствует GET /api/book
    public IActionResult GetBooks() { ... }

    [HttpGet("{id}")] // Соответствует GET /api/book/5
    public IActionResult GetBook(int id) { ... }

    [HttpPost("create")] // Соответствует POST /api/book/create
    public IActionResult CreateNewBook(Book book) { ... }
}
```
Атрибутная маршрутизация очень популярна для создания REST API.

---

### **Резюме**

*   **ASP.NET Core** — современный фреймворк для построения веб-приложений.
*   **Структура проекта** логична: `Controllers` для логики, `Views` для UI, `Models` для данных, `wwwroot` для статики, `Program.cs` для настройки.
*   **Контроллеры** наследуются от `Controller` и содержат **методы действий**.
*   **Методы действий** возвращают `IActionResult` (`View()`, `Json()`, `Content()`, `Redirect()`), обрабатывают параметры и могут быть ограничены по HTTP-методу с помощью атрибутов.
*   **Маршрутизация** связывает URL с контроллерами и действиями. Бывает конвенционная (настраивается глобально) и атрибутная (гибкая, настраивается прямо на коде).

---

### **Контрольные вопросы**

1.  Объясните назначение трех основных компонентов паттерна MVC в контексте ASP.NET Core.
2.  Какую роль выполняет файл `Program.cs` в приложении ASP.NET Core?
3.  Для чего нужна папка `wwwroot`? Приведите пример URL, который ссылается на файл из этой папки.
4.  Что такое "метод действия" (Action Method)? Какие соглашения нужно соблюдать при его создании?
5.  Объясните, как следующий URL `/Product/Edit/10` будет обработан с использованием маршрута по умолчанию. Назовите контроллер, метод действия и параметры.
6.  В чем разница между возвращаемыми типами `View()` и `Json()` в методе действия?
7.  Как заставить метод действия реагировать только на POST-запросы?
8.  Чем атрибутная маршрутизация отличается от конвенционной? В каком сценарии вы бы предпочли одну другой?