# Практическая работа. Создание REST API с помощью Minimal API

## Тема
Разработка RESTful API с использованием .NET Minimal API

## Цель
Освоить принципы создания REST API с помощью Minimal API в .NET, изучить обработку HTTP-запросов, работу с данными и внедрение зависимостей.

## Теоретическая часть

### Minimal API в .NET
Minimal API - упрощенный подход к созданию API в .NET, который позволяет:
- Быстро создавать конечные точки с минимальным количеством кода
- Использовать лямбда-выражения для обработки запросов
- Настраивать маршрутизацию и зависимости

### Основные концепции:
- **MapGet()** - обработка GET запросов
- **MapPost()** - обработка POST запросов
- **MapPut()** - обработка PUT запросов  
- **MapDelete()** - обработка DELETE запросов
- **Группировка маршрутов** - организация связанных endpoints
- **Внедрение зависимостей** - использование сервисов

## Практический пример

### Базовая структура проекта

```csharp
var builder = WebApplication.CreateBuilder(args);

// Добавление сервисов
builder.Services.AddSingleton<IBookService, BookService>();

var app = builder.Build();

// Endpoints
app.MapGet("/books", async (IBookService bookService) => 
    await bookService.GetAllBooks());

app.MapGet("/books/{id}", async (int id, IBookService bookService) => 
{
    var book = await bookService.GetBookById(id);
    return book is not null ? Results.Ok(book) : Results.NotFound();
});

app.MapPost("/books", async (Book book, IBookService bookService) => 
{
    await bookService.AddBook(book);
    return Results.Created($"/books/{book.Id}", book);
});

app.Run();
```

## Ход работы

1. Создать новый проект ASP.NET Core Web API
2. Настроить сервисы и middleware
3. Реализовать модель данных согласно варианту
4. Создать сервис для работы с данными
5. Реализовать REST endpoints
6. Протестировать API с помощью Swagger/Postman
7. Создать репозиторий и загрузить решение

## 15 вариантов заданий

### Вариант 1: Система управления задачами (ToDo List)
```csharp
// Модель: TaskItem (Id, Title, Description, IsCompleted, DueDate, Priority)
// Endpoints: GET /tasks, GET /tasks/{id}, POST /tasks, PUT /tasks/{id}, DELETE /tasks/{id}
// Доп: Фильтрация по статусу и приоритету
```

### Вариант 2: Библиотека книг
```csharp
// Модель: Book (Id, Title, Author, ISBN, PublicationYear, Genre, IsAvailable)
// Endpoints: CRUD + поиск по автору/названию, аренда/возврат книги
```

### Вариант 3: Система учета студентов
```csharp
// Модель: Student (Id, FirstName, LastName, Email, Phone, EnrollmentDate, GPA)
// Endpoints: CRUD + фильтрация по GPA, поиск по имени
```

### Вариант 4: Менеджер продуктов
```csharp
// Модель: Product (Id, Name, Description, Price, Category, StockQuantity, Manufacturer)
// Endpoints: CRUD + фильтрация по категории/цене, обновление количества
```

### Вариант 5: Сервис заказов
```csharp
// Модель: Order (Id, CustomerName, OrderDate, TotalAmount, Status, ShippingAddress)
// Endpoints: CRUD + обновление статуса, фильтрация по дате/статусу
```

### Вариант 6: Блог платформа
```csharp
// Модель: Post (Id, Title, Content, Author, PublicationDate, Tags, IsPublished)
// Endpoints: CRUD + поиск по тегам, публикация/снятие с публикации
```

### Вариант 7: Система бронирования отелей
```csharp
// Модель: Reservation (Id, GuestName, RoomNumber, CheckInDate, CheckOutDate, Status)
// Endpoints: CRUD + проверка доступности, отмена бронирования
```

### Вариант 8: Трекер расходов
```csharp
// Модель: Expense (Id, Description, Amount, Category, Date, PaymentMethod)
// Endpoints: CRUD + сумма по категориям, фильтрация по периоду
```

### Вариант 9: Каталог фильмов
```csharp
// Модель: Movie (Id, Title, Director, ReleaseYear, Genre, Rating, Duration)
// Endpoints: CRUD + поиск по жанру/режиссеру, топ по рейтингу
```

### Вариант 10: Сервис уведомлений
```csharp
// Модель: Notification (Id, Title, Message, Type, CreatedAt, IsRead, UserId)
// Endpoints: CRUD + пометка как прочитанное, получение непрочитанных
```

### Вариант 11: Инвентарь склада
```csharp
// Модель: InventoryItem (Id, Name, Category, Quantity, MinimumStock, Supplier, Location)
// Endpoints: CRUD + пополнение запасов, проверка низкого уровня
```

### Вариант 12: Система рецептов
```csharp
// Модель: Recipe (Id, Name, Ingredients, Instructions, CookingTime, Difficulty, Category)
// Endpoints: CRUD + поиск по ингредиентам, фильтрация по сложности
```

### Вариант 13: Трекер проектов
```csharp
// Модель: Project (Id, Name, Description, StartDate, EndDate, Status, Manager)
// Endpoints: CRUD + обновление статуса, проекты в работе
```

### Вариант 14: Каталог автомобилей
```csharp
// Модель: Car (Id, Make, Model, Year, Color, Price, Mileage, FuelType)
// Endpoints: CRUD + фильтрация по марке/году/цене, поиск по параметрам
```

### Вариант 15: Сервис мероприятий
```csharp
// Модель: Event (Id, Name, Description, Date, Location, Organizer, MaxAttendees)
// Endpoints: CRUD + регистрация участников, проверка доступности мест
```

## Критерии оценки

### 5 (Отлично)
- Все endpoints работают корректно
- Реализованы все дополнительные требования варианта
- Код хорошо структурирован и документирован
- Используется правильный HTTP статус коды
- Настроена группировка маршрутов
- Присутствуют комментарии и README

### 4 (Хорошо)
- Основные endpoints работают корректно
- Реализованы базовые требования
- Код читаем и логически организован
- Незначительные недочеты в реализации

### 3 (Удовлетворительно)
- Большинство endpoints работают
- Реализованы основные CRUD операции
- Возможны проблемы с обработкой ошибок

### 2 (Неудовлетворительно)
- Критические ошибки в реализации
- Endpoints не работают или работают некорректно
- Не выполнены основные требования

## Контрольные вопросы

1. Что такое Minimal API и чем он отличается от традиционного подхода?
2. Какие основные методы для создания endpoints в Minimal API?
3. Как организовать группировку маршрутов?
4. Как обрабатывать различные HTTP статус коды?
5. Какие способы внедрения зависимостей доступны в Minimal API?
6. Как валидировать входные данные?
7. Как организовать обработку ошибок?
8. Какие преимущества использования Minimal API?
9. Как документировать API с помощью Swagger?
10. Как тестировать Minimal API endpoints?

---

# Пример реализации для Варианта 1

## Структура проекта

```
TodoApi/
├── Program.cs
├── Models/
│   └── TodoItem.cs
├── Services/
│   └── ITodoService.cs
│   └── TodoService.cs
├── Properties/
│   └── launchSettings.json
├── TodoApi.csproj
├── images/
│   ├── swagger.png
│   └── postman-test.png
└── README.md
```

## Код реализации

### Program.cs
```csharp
using TodoApi.Models;
using TodoApi.Services;

var builder = WebApplication.CreateBuilder(args);

// Add services
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();
builder.Services.AddSingleton<ITodoService, TodoService>();

var app = builder.Build();

// Configure HTTP pipeline
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

app.UseHttpsRedirection();

// Routes group
var todoGroup = app.MapGroup("/todos");

todoGroup.MapGet("/", async (ITodoService todoService) => 
    await todoService.GetAllTodos());

todoGroup.MapGet("/{id}", async (int id, ITodoService todoService) => 
{
    var todo = await todoService.GetTodoById(id);
    return todo is not null ? Results.Ok(todo) : Results.NotFound();
});

todoGroup.MapPost("/", async (TodoItem todo, ITodoService todoService) => 
{
    await todoService.AddTodo(todo);
    return Results.Created($"/todos/{todo.Id}", todo);
});

todoGroup.MapPut("/{id}", async (int id, TodoItem updatedTodo, ITodoService todoService) => 
{
    var result = await todoService.UpdateTodo(id, updatedTodo);
    return result ? Results.Ok(updatedTodo) : Results.NotFound();
});

todoGroup.MapDelete("/{id}", async (int id, ITodoService todoService) => 
{
    var result = await todoService.DeleteTodo(id);
    return result ? Results.NoContent() : Results.NotFound();
});

// Additional endpoints
todoGroup.MapGet("/completed", async (ITodoService todoService) => 
    await todoService.GetCompletedTodos());

todoGroup.MapGet("/priority/{priority}", async (string priority, ITodoService todoService) => 
    await todoService.GetTodosByPriority(priority));

app.Run();
```

### Models/TodoItem.cs
```csharp
namespace TodoApi.Models;

public class TodoItem
{
    public int Id { get; set; }
    public string Title { get; set; } = string.Empty;
    public string Description { get; set; } = string.Empty;
    public bool IsCompleted { get; set; }
    public DateTime DueDate { get; set; }
    public string Priority { get; set; } = "Medium";
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
}
```

### Services/ITodoService.cs
```csharp
using TodoApi.Models;

namespace TodoApi.Services;

public interface ITodoService
{
    Task<List<TodoItem>> GetAllTodos();
    Task<TodoItem?> GetTodoById(int id);
    Task AddTodo(TodoItem todo);
    Task<bool> UpdateTodo(int id, TodoItem updatedTodo);
    Task<bool> DeleteTodo(int id);
    Task<List<TodoItem>> GetCompletedTodos();
    Task<List<TodoItem>> GetTodosByPriority(string priority);
}
```

### Services/TodoService.cs
```csharp
using TodoApi.Models;

namespace TodoApi.Services;

public class TodoService : ITodoService
{
    private readonly List<TodoItem> _todos = new();
    private int _nextId = 1;

    public Task<List<TodoItem>> GetAllTodos() => Task.FromResult(_todos);

    public Task<TodoItem?> GetTodoById(int id) => 
        Task.FromResult(_todos.FirstOrDefault(t => t.Id == id));

    public Task AddTodo(TodoItem todo)
    {
        todo.Id = _nextId++;
        _todos.Add(todo);
        return Task.CompletedTask;
    }

    public Task<bool> UpdateTodo(int id, TodoItem updatedTodo)
    {
        var existingTodo = _todos.FirstOrDefault(t => t.Id == id);
        if (existingTodo is null) return Task.FromResult(false);

        existingTodo.Title = updatedTodo.Title;
        existingTodo.Description = updatedTodo.Description;
        existingTodo.IsCompleted = updatedTodo.IsCompleted;
        existingTodo.DueDate = updatedTodo.DueDate;
        existingTodo.Priority = updatedTodo.Priority;

        return Task.FromResult(true);
    }

    public Task<bool> DeleteTodo(int id)
    {
        var todo = _todos.FirstOrDefault(t => t.Id == id);
        if (todo is null) return Task.FromResult(false);

        _todos.Remove(todo);
        return Task.FromResult(true);
    }

    public Task<List<TodoItem>> GetCompletedTodos() => 
        Task.FromResult(_todos.Where(t => t.IsCompleted).ToList());

    public Task<List<TodoItem>> GetTodosByPriority(string priority) => 
        Task.FromResult(_todos.Where(t => t.Priority.Equals(priority, StringComparison.OrdinalIgnoreCase)).ToList());
}
```

## Тестирование API

После запуска приложения можно тестировать endpoints через:
- Swagger UI: `https://localhost:PORT/swagger`
- Postman
- curl команды

### Примеры запросов:

```bash
# GET все задачи
curl -X GET "https://localhost:PORT/todos"

# POST новая задача
curl -X POST "https://localhost:PORT/todos" \
-H "Content-Type: application/json" \
-d '{
  "title": "Learn Minimal API",
  "description": "Study .NET Minimal API features",
  "isCompleted": false,
  "dueDate": "2024-12-31",
  "priority": "High"
}'
```

## Развертывание в Gogs

1. Создать репозиторий в Gogs
2. Инициализировать локальный git репозиторий
3. Добавить файлы и сделать коммит
4. Запушить в Gogs

```bash
git init
git add .
git commit -m "Add Todo API implementation"
git remote add origin http://gogs-server/username/todo-api.git
git push -u origin main
```