# Практическая работа. Получение данных с сервера в Angular

## Тема
Работа с HTTP запросами в Angular приложении

## Цель
Освоить практические навыки выполнения HTTP запросов, обработки ответов и ошибок, управления состоянием приложения при работе с серверными данными

## Теоретическая часть

### HttpClient Module
Angular предоставляет `HttpClient` для работы с HTTP запросами. Основные методы:
- `get()` - GET запрос
- `post()` - POST запрос  
- `put()` - PUT запрос
- `delete()` - DELETE запрос
- `patch()` - PATCH запрос

### Интерцепторы
Интерцепторы позволяют перехватывать и модифицировать HTTP запросы и ответы:
- Добавление заголовков
- Обработка ошибок
- Логирование
- Кэширование

### Обработка состояния
Типичные состояния при работе с HTTP:
- **Loading** - данные загружаются
- **Success** - данные успешно получены
- **Error** - произошла ошибка

## Ход работы

1. Создать Angular проект с HttpClientModule
2. Реализовать сервис для работы с API
3. Создать компоненты для отображения данных
4. Реализовать обработку состояний загрузки и ошибок
5. Добавить интерцепторы при необходимости
6. Протестировать работу приложения
7. Сделать скриншоты результатов
8. Оформить README.md

## Практический пример

### Настройка HttpClient

```typescript
// app.module.ts
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { HttpClientModule } from '@angular/common/http';

import { AppComponent } from './app.component';

@NgModule({
  declarations: [
    AppComponent
  ],
  imports: [
    BrowserModule,
    HttpClientModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }
```

### Базовый сервис для работы с API

```typescript
// data.service.ts
import { Injectable } from '@angular/core';
import { HttpClient, HttpParams, HttpHeaders } from '@angular/common/http';
import { Observable, catchError, throwError } from 'rxjs';

export interface User {
  id: number;
  name: string;
  email: string;
}

@Injectable({
  providedIn: 'root'
})
export class DataService {
  private apiUrl = 'https://jsonplaceholder.typicode.com';

  constructor(private http: HttpClient) { }

  // GET запрос для получения всех пользователей
  getUsers(): Observable<User[]> {
    return this.http.get<User[]>(`${this.apiUrl}/users`).pipe(
      catchError(this.handleError)
    );
  }

  // GET запрос с параметрами
  getUserById(id: number): Observable<User> {
    return this.http.get<User>(`${this.apiUrl}/users/${id}`).pipe(
      catchError(this.handleError)
    );
  }

  // POST запрос для создания пользователя
  createUser(user: Omit<User, 'id'>): Observable<User> {
    const headers = new HttpHeaders({
      'Content-Type': 'application/json'
    });

    return this.http.post<User>(`${this.apiUrl}/users`, user, { headers }).pipe(
      catchError(this.handleError)
    );
  }

  private handleError(error: any) {
    console.error('An error occurred:', error);
    return throwError(() => new Error('Something went wrong; please try again later.'));
  }
}
```

### Компонент для отображения данных

```typescript
// users.component.ts
import { Component, OnInit } from '@angular/core';
import { DataService, User } from '../data.service';

@Component({
  selector: 'app-users',
  template: `
    <div class="container">
      <h2>Список пользователей</h2>
      
      <!-- Состояние загрузки -->
      <div *ngIf="loading" class="loading">
        Загрузка данных...
      </div>

      <!-- Состояние ошибки -->
      <div *ngIf="error" class="error">
        Ошибка: {{ error }}
        <button (click)="loadUsers()">Повторить</button>
      </div>

      <!-- Успешная загрузка -->
      <div *ngIf="!loading && !error">
        <div class="user-card" *ngFor="let user of users">
          <h3>{{ user.name }}</h3>
          <p>Email: {{ user.email }}</p>
          <p>ID: {{ user.id }}</p>
        </div>
      </div>

      <!-- Пустой список -->
      <div *ngIf="!loading && !error && users.length === 0" class="empty">
        Пользователи не найдены
      </div>
    </div>
  `,
  styles: [`
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .loading { color: #007bff; font-size: 18px; text-align: center; }
    .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 5px; }
    .user-card { 
      border: 1px solid #ddd; 
      padding: 15px; 
      margin: 10px 0; 
      border-radius: 5px; 
    }
    .empty { text-align: center; color: #6c757d; }
  `]
})
export class UsersComponent implements OnInit {
  users: User[] = [];
  loading = false;
  error: string | null = null;

  constructor(private dataService: DataService) {}

  ngOnInit() {
    this.loadUsers();
  }

  loadUsers() {
    this.loading = true;
    this.error = null;

    this.dataService.getUsers().subscribe({
      next: (users) => {
        this.users = users;
        this.loading = false;
      },
      error: (error) => {
        this.error = error.message;
        this.loading = false;
      }
    });
  }
}
```

## 15 вариантов заданий

### Вариант 1
**Задание:** Создайте приложение для отображения списка постов с JSONPlaceholder API. Реализуйте пагинацию с кнопками "Назад" и "Вперед".

### Вариант 2  
**Задание:** Реализуйте поиск пользователей по имени с использованием debounce и отображением состояния загрузки.

### Вариант 3
**Задание:** Создайте форму для добавления нового поста с валидацией и отправкой POST запроса.

### Вариант 4
**Задание:** Реализуйте интерцептор для добавления авторизационного токена ко всем запросам.

### Вариант 5
**Задание:** Создайте сервис для кэширования GET запросов с возможностью инвалидации кэша.

### Вариант 6
**Задание:** Реализуйте обработку различных HTTP ошибок (404, 500, таймаут) с соответствующими сообщениями.

### Вариант 7
**Задание:** Создайте приложение для отображения детальной информации о пользователе по ID с загрузкой связанных данных (посты, альбомы).

### Вариант 8
**Задание:** Реализуйте параллельную загрузку данных из нескольких endpoints с использованием forkJoin.

### Вариант 9
**Задание:** Создайте интерцептор для логирования всех HTTP запросов и ответов в консоль.

### Вариант 10
**Задание:** Реализуйте бесконечную прокрутку для списка постов с подгрузкой данных при скролле.

### Вариант 11
**Задание:** Создайте сервис для загрузки файлов с отображением прогресса загрузки.

### Вариант 12
**Задание:** Реализуйте автоматическое обновление данных каждые 30 секунд с возможностью остановки/запуска.

### Вариант 13
**Задание:** Создайте форму с динамическими полями, данные для которых загружаются с сервера (список стран, городов).

### Вариант 14
**Задание:** Реализуйте оптимистичное обновление UI при редактировании данных с откатом при ошибке.

### Вариант 15
**Задание:** Создайте интерцептор для повторения неудачных запросов с экспоненциальной задержкой.

## Критерии оценки

### 5 (Отлично)
- Полностью реализовано задание согласно варианту
- Корректная обработка всех состояний (loading, success, error)
- Чистый, хорошо структурированный код
- Правильная обработка ошибок
- Использование лучших практик Angular
- Полностью оформленный README.md со скриншотами

### 4 (Хорошо)
- Задание реализовано, но есть незначительные ошибки
- Основные состояния обрабатываются корректно
- Код в основном чистый и понятный
- README.md оформлен, но может не хватать некоторых деталей

### 3 (Удовлетворительно)
- Основная функциональность реализована
- Есть существенные ошибки в обработке состояний или ошибок
- Код требует улучшений
- README.md оформлен минимально

### 2 (Неудовлетворительно)
- Задание не выполнено или выполнено некорректно
- Критические ошибки в работе приложения
- Нет обработки состояний или ошибок
- README.md отсутствует или оформлен неполно

## Контрольные вопросы

1. Как подключить HttpClientModule в Angular приложении?
2. Какие методы HTTP предоставляет HttpClient?
3. Как добавить заголовки к HTTP запросу?
4. Как обработать ошибки в HTTP запросах?
5. Что такое HTTP интерцепторы и для чего они используются?
6. Как отменить HTTP запрос в Angular?
7. В чем разница между Observable и Promise при работе с HTTP?
8. Как реализовать пагинацию на стороне клиента и сервера?
9. Какие способы кэширования HTTP запросов вы знаете?
10. Как тестировать сервисы, работающие с HttpClient?

---

# Пример README.md для варианта 1

```markdown
# Практическая работа: Получение данных с сервера в Angular

**Номер варианта:** 1  
**Студент:** [ФИО]  
**Группа:** [Номер группы]

## Задание
Создайте приложение для отображения списка постов с JSONPlaceholder API. Реализуйте пагинацию с кнопками "Назад" и "Вперед".

## Реализация

### Сервис для работы с постами
```typescript
// posts.service.ts
import { Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { Observable, catchError, throwError } from 'rxjs';

export interface Post {
  userId: number;
  id: number;
  title: string;
  body: string;
}

@Injectable({
  providedIn: 'root'
})
export class PostsService {
  private apiUrl = 'https://jsonplaceholder.typicode.com';

  constructor(private http: HttpClient) { }

  getPosts(page: number = 1, limit: number = 10): Observable<Post[]> {
    const params = new HttpParams()
      .set('_page', page.toString())
      .set('_limit', limit.toString());

    return this.http.get<Post[]>(`${this.apiUrl}/posts`, { params }).pipe(
      catchError(this.handleError)
    );
  }

  private handleError(error: any) {
    console.error('An error occurred:', error);
    return throwError(() => new Error('Failed to load posts. Please try again later.'));
  }
}
```

### Компонент с пагинацией
```typescript
// posts.component.ts
import { Component, OnInit } from '@angular/core';
import { PostsService, Post } from '../posts.service';

@Component({
  selector: 'app-posts',
  template: `
    <div class="container">
      <h2>Список постов</h2>
      
      <div *ngIf="loading" class="loading">
        Загрузка постов...
      </div>

      <div *ngIf="error" class="error">
        Ошибка: {{ error }}
        <button (click)="loadPosts()">Повторить</button>
      </div>

      <div *ngIf="!loading && !error">
        <div class="post-card" *ngFor="let post of posts">
          <h3>{{ post.title }}</h3>
          <p>{{ post.body }}</p>
          <small>Post ID: {{ post.id }}, User ID: {{ post.userId }}</small>
        </div>

        <div class="pagination">
          <button 
            (click)="previousPage()" 
            [disabled]="currentPage === 1 || loading">
            Назад
          </button>
          <span>Страница {{ currentPage }}</span>
          <button 
            (click)="nextPage()" 
            [disabled]="loading">
            Вперед
          </button>
        </div>
      </div>
    </div>
  `,
  styles: [`
    .container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .loading { color: #007bff; text-align: center; font-size: 18px; }
    .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 5px; }
    .post-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .pagination { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
    button { padding: 8px 16px; border: 1px solid #007bff; background: #007bff; color: white; border-radius: 4px; }
    button:disabled { background: #6c757d; border-color: #6c757d; cursor: not-allowed; }
  `]
})
export class PostsComponent implements OnInit {
  posts: Post[] = [];
  currentPage = 1;
  loading = false;
  error: string | null = null;
  private limit = 10;

  constructor(private postsService: PostsService) {}

  ngOnInit() {
    this.loadPosts();
  }

  loadPosts() {
    this.loading = true;
    this.error = null;

    this.postsService.getPosts(this.currentPage, this.limit).subscribe({
      next: (posts) => {
        this.posts = posts;
        this.loading = false;
      },
      error: (error) => {
        this.error = error.message;
        this.loading = false;
      }
    });
  }

  nextPage() {
    this.currentPage++;
    this.loadPosts();
  }

  previousPage() {
    if (this.currentPage > 1) {
      this.currentPage--;
      this.loadPosts();
    }
  }
}
```

## Результат работы

### Скриншот 1: Загрузка данных
![Загрузка данных](images/loading-state.png)

### Скриншот 2: Список постов с пагинацией
![Список постов](images/posts-list.png)

### Скриншот 3: Обработка ошибки
![Обработка ошибки](images/error-state.png)
```

## Структура репозитория
```
practical-work-http/
├── src/
│   ├── app/
│   │   ├── services/
│   │   │   └── data.service.ts
│   │   ├── components/
│   │   │   └── posts.component.ts
│   │   ├── interceptors/
│   │   └── models/
│   └── ...
├── images/
│   ├── loading-state.png
│   ├── posts-list.png
│   └── error-state.png
├── README.md
└── package.json
```

## Команды для развертывания в Gogs

```bash
# Инициализация репозитория
git init
git add .
git commit -m "Практическая работа: Получение данных с сервера"
git remote add origin http://gogs-server/username/practical-work-http.git
git push -u origin master
```
