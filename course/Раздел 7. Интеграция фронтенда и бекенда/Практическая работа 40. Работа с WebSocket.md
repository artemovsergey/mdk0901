# Практическая работа. Работа с WebSocket в Angular

## Тема
Реализация реального времени в Angular приложениях с использованием WebSocket

## Цель
Освоить принципы работы с WebSocket в Angular, научиться создавать клиент-серверные приложения с двусторонней связью в реальном времени.

## Теоретическая часть

### Что такое WebSocket?
WebSocket - это протокол связи, обеспечивающий полнодуплексный канал связи через одно TCP-подключение. В отличие от HTTP, WebSocket позволяет серверу отправлять данные клиенту без запроса.

### WebSocket в Angular
Для работы с WebSocket в Angular используется:
- `WebSocket` API браузера
- Сторонние библиотеки (Socket.IO, SockJS)
- Angular сервисы для управления соединением

### Основные методы WebSocket:
- `new WebSocket(url)` - создание соединения
- `socket.send(data)` - отправка данных
- `socket.onopen` - обработчик открытия соединения
- `socket.onmessage` - обработчик получения сообщений
- `socket.onclose` - обработчик закрытия соединения
- `socket.onerror` - обработчик ошибок

## Ход работы

### Практический пример: Чат-приложение

**app.module.ts**
```typescript
import { NgModule } from '@angular/core';
import { BrowserModule } from '@angular/platform-browser';
import { FormsModule } from '@angular/forms';

import { AppComponent } from './app.component';
import { ChatComponent } from './chat/chat.component';

@NgModule({
  declarations: [
    AppComponent,
    ChatComponent
  ],
  imports: [
    BrowserModule,
    FormsModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }
```

**websocket.service.ts**
```typescript
import { Injectable } from '@angular/core';
import { Observable, Subject } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class WebSocketService {
  private socket!: WebSocket;
  private messageSubject = new Subject<string>();
  public messages$ = this.messageSubject.asObservable();

  constructor() {}

  public connect(url: string): void {
    this.socket = new WebSocket(url);

    this.socket.onopen = (event) => {
      console.log('WebSocket соединение установлено');
    };

    this.socket.onmessage = (event) => {
      this.messageSubject.next(event.data);
    };

    this.socket.onclose = (event) => {
      console.log('WebSocket соединение закрыто');
    };

    this.socket.onerror = (error) => {
      console.error('WebSocket ошибка:', error);
    };
  }

  public sendMessage(message: string): void {
    if (this.socket.readyState === WebSocket.OPEN) {
      this.socket.send(message);
    }
  }

  public disconnect(): void {
    if (this.socket) {
      this.socket.close();
    }
  }
}
```

**chat.component.ts**
```typescript
import { Component, OnInit, OnDestroy } from '@angular/core';
import { WebSocketService } from '../websocket.service';
import { Subscription } from 'rxjs';

@Component({
  selector: 'app-chat',
  templateUrl: './chat.component.html',
  styleUrls: ['./chat.component.css']
})
export class ChatComponent implements OnInit, OnDestroy {
  messages: string[] = [];
  newMessage: string = '';
  private messageSubscription!: Subscription;

  constructor(private webSocketService: WebSocketService) {}

  ngOnInit(): void {
    // Подключаемся к WebSocket серверу
    this.webSocketService.connect('ws://localhost:8080');

    // Подписываемся на получение сообщений
    this.messageSubscription = this.webSocketService.messages$.subscribe(
      (message: string) => {
        this.messages.push(message);
      }
    );
  }

  sendMessage(): void {
    if (this.newMessage.trim()) {
      this.webSocketService.sendMessage(this.newMessage);
      this.newMessage = '';
    }
  }

  ngOnDestroy(): void {
    if (this.messageSubscription) {
      this.messageSubscription.unsubscribe();
    }
    this.webSocketService.disconnect();
  }
}
```

**chat.component.html**
```html
<div class="chat-container">
  <h2>WebSocket Чат</h2>
  
  <div class="messages-container">
    <div *ngFor="let message of messages" class="message">
      {{message}}
    </div>
  </div>

  <div class="input-container">
    <input 
      type="text" 
      [(ngModel)]="newMessage" 
      placeholder="Введите сообщение..."
      (keyup.enter)="sendMessage()"
      class="message-input">
    <button (click)="sendMessage()" class="send-button">
      Отправить
    </button>
  </div>
</div>
```

**chat.component.css**
```css
.chat-container {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background-color: #f9f9f9;
}

.messages-container {
  height: 400px;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 10px;
  margin-bottom: 20px;
  overflow-y: auto;
  background-color: white;
}

.message {
  padding: 8px;
  margin: 5px 0;
  border-radius: 4px;
  background-color: #e3f2fd;
}

.input-container {
  display: flex;
  gap: 10px;
}

.message-input {
  flex: 1;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 16px;
}

.send-button {
  padding: 10px 20px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
}

.send-button:hover {
  background-color: #0056b3;
}
```

## 15 вариантов заданий

### Вариант 1: Система уведомлений
Создайте систему уведомлений, где сервер отправляет случайные уведомления клиентам каждые 10 секунд.

### Вариант 2: Счетчик онлайн пользователей
Реализуйте счетчик, отображающий количество активных пользователей в реальном времени.

### Вариант 3: Простой рисовальщик
Создайте приложение, где несколько пользователей могут рисовать на общем холсте в реальном времени.

### Вариант 4: Актуальный курс валют
Реализуйте отображение актуального курса валют, обновляемого через WebSocket.

### Вариант 5: Система голосования
Создайте систему голосования с обновлением результатов в реальном времени.

### Вариант 6: Игра "Камень, ножницы, бумага"
Реализуйте многопользовательскую игру с подсчетом очков в реальном времени.

### Вариант 7: Погодная станция
Создайте приложение, отображающее данные с погодной станции, обновляемые каждые 5 секунд.

### Вариант 8: Система заказов
Реализуйте панель управления заказами с мгновенным обновлением статусов.

### Вариант 9: Спортивный табло
Создайте табло для отображения спортивных результатов в реальном времени.

### Вариант 10: Система комментариев
Реализуйте систему комментариев с мгновенным обновлением для всех пользователей.

### Вариант 11: Аукцион
Создайте систему онлайн-аукциона с обновлением ставок в реальном времени.

### Вариант 12: Мониторинг сервера
Реализуйте панель мониторинга состояния сервера с метриками в реальном времени.

### Вариант 13: Совместное редактирование
Создайте простой текстовый редактор с возможностью совместного редактирования.

### Вариант 14: Игра "Викторина"
Реализуйте многопользовательскую викторину с подсчетом баллов в реальном времени.

### Вариант 15: Трекер посылок
Создайте систему отслеживания посылок с обновлением статусов доставки.

## Критерии оценки

### 5 (Отлично)
- Полностью рабочее приложение
- Корректная обработка всех состояний WebSocket
- Оптимальная архитектура кода
- Полная реализация всех требований задания
- Качественный UI/UX

### 4 (Хорошо)
- Рабочее приложение с незначительными недочетами
- Основная функциональность реализована
- Корректная обработка основных состояний WebSocket
- Небольшие проблемы с архитектурой

### 3 (Удовлетворительно)
- Приложение работает с ограниченной функциональностью
- Есть проблемы с обработкой ошибок
- Нарушения в архитектуре приложения
- Неполная реализация требований

### 2 (Неудовлетворительно)
- Приложение не работает
- Критические ошибки в коде
- Невыполнение основных требований

## Контрольные вопросы

1. Что такое WebSocket и чем он отличается от HTTP?
2. Какие основные события WebSocket вы знаете?
3. Как обрабатывать ошибки в WebSocket соединении?
4. Какие преимущества дает использование RxJS с WebSocket?
5. Как обеспечить переподключение при обрыве соединения?
6. Какие методы безопасности важно учитывать при работе с WebSocket?
7. Как тестировать приложения с WebSocket?
8. Какие ограничения есть у WebSocket?
9. Как оптимизировать производительность при частой отправке сообщений?
10. В каких сценариях использование WebSocket наиболее оправдано?

---

# Шаблон README.md для студента

```markdown
# Практическая работа №X: Работа с WebSocket в Angular

**Вариант:** [Номер варианта]
**Студент:** [ФИО]
**Группа:** [Номер группы]

## Задание
[Текст задания согласно варианту]

## Реализация

### Код приложения

**app.module.ts**
```typescript
[код модуля]
```

**websocket.service.ts**
```typescript
[код сервиса]
```

**main-component.component.ts**
```typescript
[код компонента]
```

**main-component.component.html**
```html
[HTML шаблон]
```

**main-component.component.css**
```css
[CSS стили]
```

## Скриншоты работы программы

### Главный экран
![Главный экран](images/main-screen.png)

### Работа приложения
![Работа приложения](images/app-working.png)

## Инструкция по запуску
1. Установите зависимости: `npm install`
2. Запустите сервер: `npm start`
3. Откройте браузер и перейдите по адресу: `http://localhost:4200`

## Особенности реализации
- [Описание особенностей реализации]
- [Использованные технологии]
- [Решенные проблемы]
```

Для организации локального Git сервера Gogs выполните следующие шаги:

1. Установите Gogs согласно официальной документации
2. Создайте новый репозиторий для практической работы
3. Инициализируйте локальный репозиторий в папке проекта:
```bash
git init
git add .
git commit -m "Практическая работа: WebSocket в Angular"
git remote add origin http://localhost:3000/username/repository-name.git
git push -u origin master
```
