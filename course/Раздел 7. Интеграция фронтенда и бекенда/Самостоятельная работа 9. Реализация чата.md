# Практическая работа. Реализация чата с помощью SignalR в Angular

## Тема
Разработка real-time чат-приложения с использованием SignalR и Angular

## Цель
Освоить принципы работы с WebSocket-технологиями, научиться интегрировать SignalR с Angular фреймворком, реализовать двустороннюю коммуникацию между клиентом и сервером.

## Теоретическая часть

### Что такое SignalR?
SignalR - библиотека от Microsoft для ASP.NET, которая упрощает добавление функциональности real-time веб-приложений. Она использует WebSocket, когда это возможно, и автоматически переключается на другие технологии при необходимости.

### Основные концепции:
- **Хаб (Hub)** - основной компонент для обработки клиентских вызовов
- **Соединения** - управление подключениями клиентов
- **Группы** - организация клиентов в группы для групповой рассылки
- **События** - механизм вызова методов между клиентом и сервером

### Архитектура Angular + SignalR:
```
Angular Client ←WebSocket→ ASP.NET Core Server (SignalR Hub)
```

## Практический пример

### Серверная часть (ASP.NET Core)

```csharp
// ChatHub.cs
public class ChatHub : Hub
{
    public async Task SendMessage(string user, string message)
    {
        await Clients.All.SendAsync("ReceiveMessage", user, message);
    }

    public async Task JoinGroup(string groupName)
    {
        await Groups.AddToGroupAsync(Context.ConnectionId, groupName);
    }

    public async Task LeaveGroup(string groupName)
    {
        await Groups.RemoveFromGroupAsync(Context.ConnectionId, groupName);
    }
}
```

### Клиентская часть (Angular)

```typescript
// chat.service.ts
import { Injectable } from '@angular/core';
import * as signalR from '@microsoft/signalr';

@Injectable({
  providedIn: 'root'
})
export class ChatService {
  private hubConnection: signalR.HubConnection;

  public startConnection(): Promise<void> {
    this.hubConnection = new signalR.HubConnectionBuilder()
      .withUrl('https://localhost:5001/chat')
      .build();

    return this.hubConnection.start();
  }

  public addMessageListener(callback: (user: string, message: string) => void): void {
    this.hubConnection.on('ReceiveMessage', callback);
  }

  public sendMessage(user: string, message: string): Promise<void> {
    return this.hubConnection.invoke('SendMessage', user, message);
  }
}
```

## Ход работы

1. **Подготовка окружения**
   - Установить Node.js и Angular CLI
   - Установить .NET SDK
   - Создать новый Angular проект
   - Создать ASP.NET Core Web API проект

2. **Настройка серверной части**
   - Добавить SignalR пакет
   - Создать ChatHub класс
   - Настроить CORS политику

3. **Разработка клиентской части**
   - Установить SignalR клиент для JavaScript
   - Создать Angular сервис для работы с SignalR
   - Разработать компоненты чата

4. **Тестирование приложения**
   - Запустить сервер и клиент
   - Проверить отправку и получение сообщений
   - Протестировать работу в нескольких браузерах

## Варианты заданий

### Вариант 1: Базовый чат
Реализовать простой чат с возможностью отправки и получения сообщений.

### Вариант 2: Чат с комнатами
Добавить возможность создания и переключения между комнатами.

### Вариант 3: Приватные сообщения
Реализовать отправку приватных сообщений конкретным пользователям.

### Вариант 4: Уведомления
Добавить звуковые и визуальные уведомления о новых сообщениях.

### Вариант 5: История сообщений
Сохранять историю сообщений и отображать ее при подключении.

### Вариант 6: Online/Offline статусы
Отображать статус пользователей (online/offline).

### Вариант 7: Файлообменник
Добавить возможность отправки файлов через чат.

### Вариант 8: Emoji реакции
Реализовать добавление emoji реакций к сообщениям.

### Вариант 9: Голосовые сообщения
Добавить запись и отправку голосовых сообщений.

### Вариант 10: Видео-чат
Интегрировать видео-звонки между пользователями.

### Вариант 11: Скриншот-чат
Добавить возможность делать и отправлять скриншоты.

### Вариант 12: Геолокация
Показывать местоположение пользователей на карте.

### Вариант 13: Игровой чат
Создать чат для онлайн-игры с игровыми событиями.

### Вариант 14: Бот-помощник
Интегрировать чат-бота для автоматических ответов.

### Вариант 15: Модерация
Добавить систему модерации сообщений и пользователей.

## Критерии оценки

**5 (Отлично):**
- Полностью рабочее приложение
- Реализованы все требования варианта
- Чистый и хорошо структурированный код
- Корректная обработка ошибок
- Красивый UI/UX дизайн

**4 (Хорошо):**
- Рабочее приложение с незначительными недочетами
- Реализованы основные требования
- Хорошая структура кода
- Базовая обработка ошибок

**3 (Удовлетворительно):**
- Приложение работает с ограниченной функциональностью
- Реализованы только базовые функции
- Код требует улучшения структуры
- Отсутствует обработка ошибок

**2 (Неудовлетворительно):**
- Приложение не работает или работает некорректно
- Не выполнены основные требования
- Код плохого качества

## Контрольные вопросы

1. Что такое SignalR и для чего он используется?
2. Какие транспорты использует SignalR?
3. Как организована двусторонняя коммуникация в SignalR?
4. Что такое Hub в контексте SignalR?
5. Как обрабатывать ошибки соединения в SignalR?
6. Какие преимущества у WebSocket перед HTTP?
7. Как масштабировать SignalR приложение?
8. Как обеспечить безопасность SignalR соединений?
9. В чем разница между `SendAsync` и `InvokeAsync`?
10. Как работать с группами в SignalR?

---

# Структура репозитория для практической работы

```
practical-work-chat/
│
├── index.html
├── styles.css
├── readme.md
└── images/
    ├── screenshot1.png
    ├── screenshot2.png
    └── screenshot3.png
```

## Пример README.md для варианта 1

```markdown
# Практическая работа №X: Реализация чата с помощью SignalR в Angular

**Вариант:** 1
**Студент:** [ФИО]
**Группа:** [Номер группы]

## Задание
Реализовать простое чат-приложение с использованием SignalR и Angular с возможностью отправки и получения сообщений в реальном времени.

## Реализация

### Серверная часть (ASP.NET Core)

```csharp
public class ChatHub : Hub
{
    public async Task SendMessage(string user, string message)
    {
        await Clients.All.SendAsync("ReceiveMessage", user, message);
    }
}
```

### Клиентская часть (Angular)

```typescript
export class ChatComponent implements OnInit {
  messages: string[] = [];
  currentMessage: string = '';
  user: string = '';

  constructor(private chatService: ChatService) {}

  ngOnInit() {
    this.chatService.startConnection();
    this.chatService.addMessageListener((user, message) => {
      this.messages.push(`${user}: ${message}`);
    });
  }

  sendMessage() {
    this.chatService.sendMessage(this.user, this.currentMessage);
    this.currentMessage = '';
  }
}
```

## Скриншоты

![Главный экран чата](images/screenshot1.png)
![Отправка сообщения](images/screenshot2.png)

## Запуск проекта

1. Запустите серверную часть:
```bash
cd ChatServer
dotnet run
```

2. Запустите клиентскую часть:
```bash
cd chat-client
ng serve
```

3. Откройте браузер и перейдите по адресу `http://localhost:4200`
```

## Дополнительные рекомендации

1. **Организация кода:** Соблюдайте принципы чистой архитектуры и разделения ответственности
2. **Обработка ошибок:** Реализуйте механизм обработки ошибок соединения
3. **Тестирование:** Напишите unit-тесты для основных компонентов
4. **Документация:** Комментируйте сложные участки кода
5. **Производительность:** Оптимизируйте работу с памятью и сетевыми запросами

Для сдачи работы необходимо:
1. Создать репозиторий на локальном Gogs сервере
2. Загрузить код с соблюдением структуры проекта
3. Добавить подробный README.md
4. Предоставить ссылку на репозиторий преподавателю